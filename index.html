<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PennyDash - Personal Budgeting</title>
  
  <!-- Favicon -->
  <link rel="icon" href="generated-icon.png" type="image/png">
  
  <!-- Google Fonts: Inter + DM Serif Display -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS with DaisyUI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" type="text/css" />
  
  <!-- Vue.js and Chart.js -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Reports View Styles -->
  <style>
    .reports-container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }
    
    .loading-placeholder {
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
  
  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#7C3AED',
            'primary-focus': '#6D28D9',
            'primary-content': '#FFFFFF',
            secondary: '#FFD700',
            'secondary-focus': '#EAC700',
            'secondary-content': '#000000',
            accent: '#7C3AED',
            'accent-focus': '#6D28D9',
            'accent-content': '#FFFFFF',
            neutral: '#121212',
            'neutral-focus': '#222222',
            'neutral-content': '#FFFFFF',
            'base-100': '#000000',
            'base-200': '#121212',
            'base-300': '#222222',
            'base-content': '#FFFFFF',
            info: '#3ABFF8',
            success: '#36D399',
            warning: '#FBBD23',
            error: '#F87272'
          },
          animation: {
            'fade-in': 'fadeIn 0.4s ease-out forwards',
            'slide-in': 'slideIn 0.3s ease-out forwards'
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: 0, transform: 'translateY(12px)' },
              '100%': { opacity: 1, transform: 'translateY(0)' }
            },
            slideIn: {
              '0%': { opacity: 0, transform: 'translateX(-12px)' },
              '100%': { opacity: 1, transform: 'translateX(0)' }
            }
          }
        }
      },
      plugins: [],
      daisyui: {
        themes: [
          {
            pennydash: {
              "primary": "#7C3AED",
              "primary-focus": "#6D28D9",
              "primary-content": "#FFFFFF",
              "secondary": "#FFD700",
              "secondary-focus": "#EAC700",
              "secondary-content": "#000000",
              "accent": "#7C3AED",
              "accent-focus": "#6D28D9",
              "accent-content": "#FFFFFF",
              "neutral": "#121212",
              "neutral-focus": "#222222",
              "neutral-content": "#FFFFFF",
              "base-100": "#000000",
              "base-200": "#121212",
              "base-300": "#222222",
              "base-content": "#FFFFFF",
              "info": "#3ABFF8",
              "success": "#36D399",
              "warning": "#FBBD23",
              "error": "#F87272"
            }
          }
        ],
        darkTheme: "pennydash"
      }
    }
  </script>
  
  <style>
    :root {
      /* Color system based on Riverside app design */
      --primary: #7C3AED;
      --primary-hover: #6D28D9;
      --primary-light: rgba(124, 58, 237, 0.15);
      --primary-50: rgba(124, 58, 237, 0.05);
      --primary-100: rgba(124, 58, 237, 0.1);
      
      --accent: #7C3AED;
      --accent-hover: #6D28D9;
      --accent-light: rgba(124, 58, 237, 0.15);
      
      --secondary: #FFD700;
      --secondary-hover: #EAC700;
      --secondary-light: rgba(255, 215, 0, 0.2);
      
      --bg-dark: #000000;
      --bg-dark-secondary: #121212;
      --bg-card: #121212;
      --bg-input: #222222;
      --bg-muted: #222222;
      
      --text-primary: #FFFFFF;
      --text-secondary: #ABABAB;
      --text-disabled: #666666;
      
      --border-default: #222222;
      --border-hover: #333333;
      --border-focus: #7C3AED;
      
      --success: #36D399;
      --warning: #FFD700;
      --error: #F87272;
      
      --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.2);
      --shadow-md: 0 4px 15px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.4);
      
      --radius-btn: 8px;
      --radius-card: 12px;
      --radius-input: 8px;
      --radius-badge: 16px;
      
      /* Spacing system */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      
      /* Transitions */
      --transition-fast: 150ms ease-out;
      --transition-normal: 200ms ease-out;
      
      /* Soft color variants */
      --soft-blue: rgba(63, 131, 248, 0.1);
      --soft-lavender: rgba(255, 255, 255, 0.8);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    h1 {
      font-size: 28px;
      line-height: 1.4;
    }
    
    h2 {
      font-size: 22px;
      line-height: 1.4;
    }
    
    h3 {
      font-size: 18px;
      line-height: 1.4;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* Cards */
    .card {
      background-color: var(--bg-card);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-normal);
      border: none;
      padding: var(--space-6);
    }
    
    .card:hover {
      box-shadow: var(--shadow-md);
      filter: brightness(1.05);
    }
    
    .card-body {
      padding: 0;
    }
    
    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-btn);
      font-weight: 600;
      font-size: 14px;
      padding: 12px 24px;
      cursor: pointer;
      transition: all var(--transition-fast);
      white-space: nowrap;
      outline: none;
      border: none;
      height: 40px;
    }
    
    .btn-sm {
      padding: 8px 16px;
      height: 32px;
      font-size: 13px;
    }
    
    .btn-icon {
      margin-right: 8px;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: var(--text-primary);
    }
    
    .btn-primary:hover {
      filter: brightness(1.1);
      transform: scale(1.02);
    }
    
    .btn-primary:active {
      filter: brightness(0.95);
      transform: scale(1);
    }
    
    .btn-secondary {
      background-color: var(--bg-muted);
      color: var(--text-primary);
      border: none;
    }
    
    .btn-secondary:hover {
      filter: brightness(1.1);
      color: var(--text-primary);
    }
    
    .btn-accent {
      background-color: var(--accent);
      color: var(--text-primary);
    }
    
    .btn-accent:hover {
      filter: brightness(1.1);
      transform: scale(1.02);
    }
    
    .btn-ghost {
      background-color: transparent;
      color: var(--text-primary);
    }
    
    .btn-ghost:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    /* Upload Zone */
    .upload-zone {
      border: 2px dashed var(--border-hover);
      border-radius: var(--radius-card);
      background-color: var(--bg-muted);
      transition: all var(--transition-fast);
      padding: var(--space-6);
    }
    
    .upload-zone:hover, .upload-zone.active {
      border-color: var(--primary);
      background-color: rgba(124, 58, 237, 0.1);
      transform: scale(1.01);
    }
    
    /* Progress elements */
    .progress-bar {
      height: 8px;
      border-radius: 4px;
      background-color: var(--bg-muted);
      overflow: hidden;
    }
    
    .progress-bar-fill {
      height: 100%;
      background-color: var(--primary);
      transition: width 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    /* Navigation */
    .navbar {
      background-color: var(--bg-dark);
      border-bottom: 1px solid var(--border-default);
      padding: var(--space-4) 0;
    }
    
    .nav-item {
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-btn);
      transition: all var(--transition-fast);
      color: var(--text-secondary);
      font-weight: 500;
    }
    
    .nav-item:hover {
      color: var(--text-primary);
      background-color: var(--bg-muted);
    }
    
    .nav-item.active {
      background-color: var(--primary);
      color: var(--text-primary);
      font-weight: 600;
    }
    
    .menu-horizontal a {
      color: var(--text-secondary);
      font-weight: 500;
      transition: all var(--transition-fast);
    }
    
    .menu-horizontal a:hover {
      color: var(--text-primary);
    }
    
    .menu-horizontal a.active {
      color: var(--primary);
      font-weight: 600;
    }
    
    /* Step indicators */
    .step-circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    .step-circle.active {
      background-color: var(--primary);
      color: white;
      box-shadow: 0 3px 10px rgba(65, 46, 188, 0.3);
    }
    
    .step-circle.completed {
      background-color: var(--success);
      color: white;
    }
    
    .step-circle.inactive {
      background-color: var(--bg-muted);
      color: var(--text-muted);
    }
    
    .step-line {
      height: 2px;
      background-color: var(--bg-muted);
      position: relative;
    }
    
    .step-line::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background-color: var(--primary);
      transition: width 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    .step-line.half::after {
      width: 50%;
    }
    
    .step-line.complete::after {
      width: 100%;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-12px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.4s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
    }
    
    .slide-in {
      animation: slideIn 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
    }
    
    /* Misc styles */
    .badge {
      padding: 4px 12px;
      border-radius: var(--radius-badge);
      font-size: 12px;
      font-weight: 500;
      transition: all var(--transition-fast);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .badge-success {
      background-color: rgba(54, 211, 153, 0.15);
      color: var(--success);
    }
    
    .badge-primary {
      background-color: var(--primary-light);
      color: var(--text-primary);
    }
    
    .badge-warning {
      background-color: rgba(255, 215, 0, 0.15);
      color: var(--warning);
    }
    
    .badge-accent {
      background-color: var(--primary-light);
      color: var(--text-primary);
    }
    
    .badge-outline {
      background-color: transparent;
      border: 1px solid currentColor;
    }
    
    .badge-pro {
      background-color: var(--bg-dark);
      color: var(--secondary);
      border: 1px solid var(--secondary);
      font-weight: 600;
    }
    
    .icon-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--soft-blue);
      color: var(--primary);
      transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    .icon-circle:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(37, 30, 90, 0.1);
    }
    
    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: var(--secondary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }
    
    .avatar:hover {
      border-color: var(--secondary-hover);
      transform: scale(1.05);
      background-color: var(--secondary-hover);
    }
  </style>
  
  <!-- Transaction Enrichment Flow Styles -->
  <style>
    .upload-enrichment-modal {
      max-width: 1000px;
      width: calc(100% - 2rem);
      margin: 0 auto;
    }
    
    .transaction-batch {
      border-left: 3px solid #7C3AED;
      transition: all 0.3s ease;
    }
    
    .transaction-batch:hover {
      background-color: rgba(124, 58, 237, 0.05);
    }
    
    .batch-progress {
      height: 0.5rem;
      border-radius: 9999px;
      background: linear-gradient(to right, #7C3AED, #10b981);
    }
    
    .transaction-attribute-tag {
      background-color: rgba(124, 58, 237, 0.1);
      color: #7C3AED;
      border-radius: 9999px;
      padding: 0.25rem 0.75rem;
      display: inline-flex;
      align-items: center;
      font-size: 0.75rem;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .confetti-animation {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 10;
    }
    
    .transaction-table-compact th, .transaction-table-compact td {
      padding: 0.5rem;
      font-size: 0.875rem;
    }
    
    .attribute-selector {
      border: 1px solid rgba(124, 58, 237, 0.3);
      border-radius: 0.375rem;
      transition: all 0.2s ease;
    }
    
    .attribute-selector:focus-within {
      border-color: #7C3AED;
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
    }
    
    .tag-animation {
      animation: tagSlideIn 0.3s ease-out forwards;
    }
    
    @keyframes tagSlideIn {
      0% { 
        opacity: 0;
        transform: translateY(8px);
      }
      100% { 
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body data-theme="pennydash" class="min-h-screen bg-base-100 text-base-content">
  <div id="app">
    <div class="flex min-h-screen">
      <!-- Sidebar Navigation -->
      <div class="w-64 bg-base-300 border-r border-base-200 shrink-0 hidden md:block">
        <!-- App Logo -->
        <div class="py-6 px-5 flex items-center gap-3">
          <div class="btn btn-circle btn-ghost text-accent bg-base-200">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 01-.75.75h-.75m0-1.5h.75a.75.75 0 01.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
            </svg>
          </div>
          <a class="font-serif text-xl font-semibold text-accent">PennyDash</a>
        </div>
        
        <!-- Sidebar Navigation Menu -->
        <nav class="pt-4">
          <ul class="menu menu-vertical px-4 gap-1">
            <li>
              <a @click="activeTab = 'home'" :class="activeTab === 'home' ? 'bg-primary/20 text-primary' : ''" class="flex items-center py-3 px-4 rounded-lg transition-all">
                <div class="w-7 h-7 flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                  </svg>
                </div>
                Dashboard
              </a>
            </li>
            <li>
              <a @click="activeTab = 'transactions'" :class="activeTab === 'transactions' ? 'bg-primary/20 text-primary' : ''" class="flex items-center py-3 px-4 rounded-lg transition-all">
                <div class="w-7 h-7 flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
                  </svg>
                </div>
                Transactions
              </a>
            </li>
            <li>
              <a @click="activeTab = 'categories'" :class="activeTab === 'categories' ? 'bg-primary/20 text-primary' : ''" class="flex items-center py-3 px-4 rounded-lg transition-all">
                <div class="w-7 h-7 flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
                  </svg>
                </div>
                Categories
              </a>
            </li>
            <li>
              <a @click="activeTab = 'reports'" :class="activeTab === 'reports' ? 'bg-primary/20 text-primary' : ''" class="flex items-center py-3 px-4 rounded-lg transition-all">
                <div class="w-7 h-7 flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 107.5 7.5h-7.5V6z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0013.5 3v7.5z" />
                  </svg>
                </div>
                Reports
              </a>
            </li>
            <li>
              <a @click="activeTab = 'settings'" :class="activeTab === 'settings' ? 'bg-primary/20 text-primary' : ''" class="flex items-center py-3 px-4 rounded-lg transition-all">
                <div class="w-7 h-7 flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                </div>
                Settings
              </a>
            </li>
          </ul>
        </nav>
      </div>
      
      <!-- Mobile Navigation Menu -->
      <div class="btm-nav z-50 bg-base-200 border-t border-base-300 md:hidden">
        <button @click="activeTab = 'home'" :class="activeTab === 'home' ? 'active text-primary' : ''">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
          </svg>
          <span class="btm-nav-label text-xs">Home</span>
        </button>
        <button @click="activeTab = 'transactions'" :class="activeTab === 'transactions' ? 'active text-primary' : ''">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
          </svg>
          <span class="btm-nav-label text-xs">Transactions</span>
        </button>
        <button @click="activeTab = 'reports'" :class="activeTab === 'reports' ? 'active text-primary' : ''">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 107.5 7.5h-7.5V6z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0013.5 3v7.5z" />
          </svg>
          <span class="btm-nav-label text-xs">Reports</span>
        </button>
        <button @click="activeTab = 'more'" :class="activeTab === 'more' ? 'active text-primary' : ''">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
          <span class="btm-nav-label text-xs">More</span>
        </button>
      </div>
      
      <!-- Main Content Area -->
      <div class="flex-1 p-4 md:px-6 md:py-8 overflow-y-auto pb-20 md:pb-8">
        <!-- Dashboard View -->
        <div v-if="activeTab === 'home'" class="space-y-6">
          <h1 class="text-2xl font-bold mb-6">Dashboard</h1>
          
          <!-- Upload Transaction Card -->
          <div class="card bg-base-200 shadow-md transition-all hover:shadow-lg">
            <div class="p-6">
              <h2 class="text-xl font-semibold mb-4">Upload Transactions</h2>
              <p class="text-base-content/80 mb-4">
                Import your transactions from your bank or financial institution to get started.
              </p>
              
              <div 
                class="upload-zone text-center p-8 cursor-pointer"
                :class="{'active': isUploadActive}"
                @click="$refs.fileInput.click()"
                @dragover.prevent="setUploadActive(true)"
                @dragleave.prevent="setUploadActive(false)"
                @drop.prevent="handleFileDrop($event); setUploadActive(false);"
              >
                <input 
                  type="file" 
                  ref="fileInput" 
                  class="hidden" 
                  @change="handleFileUpload"
                  accept=".csv,.ofx,.qfx,.pdf,.xlsx,.xls,.xml"
                >
                <div class="flex flex-col items-center justify-center gap-3">
                  <div class="bg-primary/20 p-3 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                  </div>
                  <div>
                    <p class="font-medium text-base-content">Drag & drop files here or <span class="text-primary">browse</span></p>
                    <p class="text-sm text-base-content/70 mt-1">Supports CSV, OFX, QFX, PDF, and Excel files</p>
                  </div>
                </div>
              </div>
              
              <!-- Error Alert (only show when there's an upload error) -->
              <div v-if="state.errors.upload" class="mt-4 alert alert-error">
                <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>{{ state.errors.upload }}</span>
              </div>
              
              <!-- Success Alert (only show when there's a success message) -->
              <div v-if="state.successMessages.upload" class="mt-4 alert alert-success">
                <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>{{ state.successMessages.upload }}</span>
              </div>
              
              <!-- Upload Progress (only show when something is uploaded) -->
              <div v-if="uploadProgress > 0" class="mt-4">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-sm font-medium">Upload Progress</span>
                  <span class="text-sm font-medium">{{uploadProgress}}%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-bar-fill" :style="{width: uploadProgress + '%'}"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <div class="card bg-base-200 shadow text-center transition-all hover:bg-primary/10 cursor-pointer">
              <div class="p-4 py-6 flex flex-col items-center">
                <div class="bg-base-300 p-3 rounded-full mb-3">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                  </svg>
                </div>
                <span class="font-medium">Upload</span>
              </div>
            </div>
            
            <div class="card bg-base-200 shadow text-center transition-all hover:bg-primary/10 cursor-pointer">
              <div class="p-4 py-6 flex flex-col items-center">
                <div class="bg-base-300 p-3 rounded-full mb-3">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
                  </svg>
                </div>
                <span class="font-medium">Categorize</span>
              </div>
            </div>
            
            <div class="card bg-base-200 shadow text-center transition-all hover:bg-primary/10 cursor-pointer" @click="activeTab = 'reports'">
              <div class="p-4 py-6 flex flex-col items-center">
                <div class="bg-base-300 p-3 rounded-full mb-3">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 107.5 7.5h-7.5V6z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0013.5 3v7.5z" />
                  </svg>
                </div>
                <span class="font-medium">Create Report</span>
              </div>
            </div>
            
            <div class="card bg-base-200 shadow text-center transition-all hover:bg-primary/10 cursor-pointer">
              <div class="p-4 py-6 flex flex-col items-center">
                <div class="bg-base-300 p-3 rounded-full mb-3">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <span class="font-medium">Add Category</span>
              </div>
            </div>
          </div>
          
          <!-- KPI Cards -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- KPI 1: Spending vs Income -->
            <div class="card bg-base-200 shadow-md">
              <div class="p-5">
                <div class="flex items-center mb-3">
                  <div class="icon-circle bg-primary/20 text-primary mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  <h3 class="text-lg font-medium">Spending vs Income</h3>
                </div>
                
                <div v-if="!hasData" class="animate-pulse space-y-3">
                  <div class="h-4 bg-base-300 rounded w-3/4"></div>
                  <div class="h-10 bg-base-300 rounded"></div>
                  <div class="h-4 bg-base-300 rounded w-1/2"></div>
                </div>
                
                <div v-else>
                  <div class="flex items-end justify-between">
                    <div>
                      <p class="text-sm text-base-content/70">Current Month</p>
                      <p class="text-2xl font-bold">{{ formatCurrency(state.incomeVsExpenses.net) }}</p>
                    </div>
                    <div class="text-right">
                      <span class="badge" :class="state.incomeVsExpenses.net >= 0 ? 'badge-success' : 'badge-error'">
                        {{ state.incomeVsExpenses.savingsRate.toFixed(0) }}%
                      </span>
                    </div>
                  </div>
                  
                  <div class="mt-4">
                    <div class="flex justify-between items-center mb-1">
                      <span class="text-xs text-base-content/70">Spending</span>
                      <span class="text-xs font-medium">
                        {{ state.incomeVsExpenses.income > 0 
                          ? ((state.incomeVsExpenses.expenses / state.incomeVsExpenses.income) * 100).toFixed(0) 
                          : 0 }}%
                      </span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-bar-fill" 
                        :style="{ 
                          width: state.incomeVsExpenses.income > 0 
                            ? ((state.incomeVsExpenses.expenses / state.incomeVsExpenses.income) * 100) + '%'
                            : '0%',
                          backgroundColor: 'var(--error)'
                        }">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- KPI 2: Top Spending Categories -->
            <div class="card bg-base-200 shadow-md">
              <div class="p-5">
                <div class="flex items-center mb-3">
                  <div class="icon-circle bg-primary/20 text-primary mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
                    </svg>
                  </div>
                  <h3 class="text-lg font-medium">Top Categories</h3>
                </div>
                
                <div v-if="!hasData" class="animate-pulse space-y-3">
                  <div class="h-4 bg-base-300 rounded w-3/4"></div>
                  <div class="space-y-2">
                    <div class="h-5 bg-base-300 rounded"></div>
                    <div class="h-5 bg-base-300 rounded"></div>
                    <div class="h-5 bg-base-300 rounded"></div>
                  </div>
                </div>
                
                <div v-else class="space-y-3">
                  <!-- Using top merchants as a temporary proxy for categories until categorization is fully implemented -->
                  <div v-if="state.topMerchants.length === 0" class="text-center text-sm text-base-content/70">
                    No categories data available yet
                  </div>
                  
                  <div v-for="(merchant, index) in state.topMerchants.slice(0, 3)" :key="index" class="flex justify-between items-center">
                    <span class="text-sm">{{ merchant.merchant || 'Uncategorized' }}</span>
                    <span class="text-sm font-medium">{{ formatCurrency(merchant.total) }}</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- KPI 3: Spending Over Time -->
            <div class="card bg-base-200 shadow-md">
              <div class="p-5">
                <div class="flex items-center mb-3">
                  <div class="icon-circle bg-primary/20 text-primary mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                    </svg>
                  </div>
                  <h3 class="text-lg font-medium">Spending Trend</h3>
                </div>
                
                <div v-if="!hasData" class="animate-pulse space-y-3">
                  <div class="h-4 bg-base-300 rounded w-3/4"></div>
                  <div class="h-24 bg-base-300 rounded"></div>
                </div>
                
                <div v-else>
                  <div class="flex items-end justify-between mb-3">
                    <div>
                      <p class="text-sm text-base-content/70">Total Expenses</p>
                      <p class="text-sm font-medium" :class="state.incomeVsExpenses.net >= 0 ? 'text-success' : 'text-error'">
                        {{ state.incomeVsExpenses.expenses > 0 ? formatCurrency(state.incomeVsExpenses.expenses) : '$0' }}
                      </p>
                    </div>
                    <div class="text-right">
                      <span class="text-sm font-medium">
                        {{ state.categorizationStatus.total }} transactions
                      </span>
                    </div>
                  </div>
                  
                  <!-- Categorization progress bar -->
                  <div class="mt-4">
                    <div class="flex justify-between items-center mb-1">
                      <span class="text-xs text-base-content/70">Categorized</span>
                      <span class="text-xs font-medium">{{ state.categorizationStatus.percentage.toFixed(1) }}%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-bar-fill" 
                        :style="{ 
                          width: state.categorizationStatus.percentage + '%',
                          backgroundColor: 'var(--primary)'
                        }">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- KPI 4: Remaining Budget -->
            <div class="card bg-base-200 shadow-md">
              <div class="p-5">
                <div class="flex items-center mb-3">
                  <div class="icon-circle bg-primary/20 text-primary mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 01-.75.75h-.75m0-1.5h.75a.75.75 0 01.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                    </svg>
                  </div>
                  <h3 class="text-lg font-medium">Budget Status</h3>
                </div>
                
                <div v-if="!hasData" class="animate-pulse space-y-3">
                  <div class="h-4 bg-base-300 rounded w-3/4"></div>
                  <div class="h-32 bg-base-300 rounded"></div>
                </div>
                
                <div v-else>
                  <div class="text-center mb-2">
                    <p class="text-sm text-base-content/70">Net Balance</p>
                    <p class="text-2xl font-bold">{{ formatCurrency(state.incomeVsExpenses.net) }}</p>
                    <p class="text-sm">
                      Income: {{ formatCurrency(state.incomeVsExpenses.income) }} | 
                      Expenses: {{ formatCurrency(state.incomeVsExpenses.expenses) }}
                    </p>
                  </div>
                  
                  <div class="mt-3 flex items-center justify-center">
                    <div class="radial-progress" 
                      :class="state.incomeVsExpenses.net >= 0 ? 'text-success' : 'text-error'"
                      :style="`--value:${state.incomeVsExpenses.savingsRate > 100 ? 100 : Math.max(0, state.incomeVsExpenses.savingsRate)}; --size:5rem;`">
                      {{ state.incomeVsExpenses.savingsRate.toFixed(0) }}%
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Recent Transactions -->
          <div class="card bg-base-200 shadow-md mt-6">
            <div class="p-5">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium">Recent Transactions</h3>
                <button class="btn btn-sm btn-ghost" @click="activeTab = 'transactions'">View All</button>
              </div>
              
              <div v-if="!hasData || state.loading.transactions" class="animate-pulse space-y-4">
                <div class="h-12 bg-base-300 rounded"></div>
                <div class="h-12 bg-base-300 rounded"></div>
                <div class="h-12 bg-base-300 rounded"></div>
              </div>
              
              <div v-else-if="state.recentTransactions.length === 0" class="text-center py-6 text-base-content/70">
                No recent transactions found. Upload transactions to get started.
              </div>
              
              <div v-else class="overflow-x-auto">
                <table class="table table-zebra w-full">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Description</th>
                      <th>Amount</th>
                      <th>Category</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="tx in state.recentTransactions.slice(0, 5)" :key="tx.id" class="hover">
                      <td>{{ formatDate(tx.date) }}</td>
                      <td>
                        <div>
                          <div class="font-medium">{{ tx.description }}</div>
                          <div class="text-sm opacity-70">{{ tx.merchant || 'Unknown' }}</div>
                        </div>
                      </td>
                      <td :class="tx.type === 'income' ? 'text-success' : 'text-error'">
                        {{ tx.type === 'income' ? '+' : '-' }} {{ formatCurrency(Math.abs(tx.amount)) }}
                      </td>
                      <td>
                        <div class="badge" :style="{ backgroundColor: getCategoryColor(tx.category?.id), color: 'white' }">
                          {{ tx.category?.name || 'Uncategorized' }}
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Transactions View -->
        <div v-if="activeTab === 'transactions'" class="transactions-container">
          <!-- Transactions Controls -->
          <div class="mb-6 flex flex-wrap gap-3 items-center justify-between">
            <h1 class="text-2xl font-bold">Transactions</h1>
            
            <!-- Quick Filters -->
            <div class="flex items-center space-x-2">
              <div class="form-control">
                <div class="input-group">
                  <div class="relative w-full">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-base-content/70" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                    </div>
                    <input 
                      type="text" 
                      v-model="transactionSearchQuery" 
                      placeholder="Search transactions..." 
                      class="input input-bordered w-full pl-10 focus:border-primary focus:ring-1 focus:ring-primary"
                      @input="filterTransactions"
                    />
                  </div>
                </div>
              </div>
              <div class="dropdown dropdown-end">
                <button class="btn btn-outline" @click="toggleFilterDropdown">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z" />
                  </svg>
                  Filters
                </button>
                <ul v-if="isFilterDropdownOpen" class="dropdown-content z-[1] menu p-2 shadow bg-base-200 rounded-box w-64 mt-1">
                  <li class="menu-title">Transaction Type</li>
                  <li><a @click.stop="setTransactionTypeFilter('all')" :class="{'font-bold text-primary': transactionTypeFilter === 'all'}">All</a></li>
                  <li><a @click.stop="setTransactionTypeFilter('income')" :class="{'font-bold text-primary': transactionTypeFilter === 'income'}">Income</a></li>
                  <li><a @click.stop="setTransactionTypeFilter('expense')" :class="{'font-bold text-primary': transactionTypeFilter === 'expense'}">Expenses</a></li>

                  <li class="menu-title pt-2">Date Range</li>
                  <li><a @click.stop="setTransactionDateFilter('all')" :class="{'font-bold text-primary': transactionDateFilter === 'all'}">All Time</a></li>
                  <li><a @click.stop="setTransactionDateFilter('thisMonth')" :class="{'font-bold text-primary': transactionDateFilter === 'thisMonth'}">This Month</a></li>
                  <li><a @click.stop="setTransactionDateFilter('last3Months')" :class="{'font-bold text-primary': transactionDateFilter === 'last3Months'}">Last 3 Months</a></li>
                  
                  <li class="menu-title pt-2">Category</li>
                  <li><a @click.stop="setCategoryFilter('all')" :class="{'font-bold text-primary': categoryFilter === 'all'}">All Categories</a></li>
                  <li><a @click.stop="setCategoryFilter('uncategorized')" :class="{'font-bold text-primary': categoryFilter === 'uncategorized'}">Uncategorized</a></li>
                  <li v-for="category in state.categories" :key="category.id">
                    <a @click.stop="setCategoryFilter(category.id)" :class="{'font-bold text-primary': categoryFilter === category.id}">
                      <span class="badge badge-sm mr-1" :style="{ backgroundColor: category.color, color: 'white' }"></span>
                      {{ category.name }}
                    </a>
                  </li>
                </ul>
              </div>
              <button class="btn btn-primary" @click="openBatchCategoryModal" :disabled="filteredTransactions.length === 0">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                </svg>
                Categorize
              </button>
            </div>
          </div>
          
          <!-- Transaction Stats Summary -->
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
            <div class="stats shadow bg-base-200">
              <div class="stat">
                <div class="stat-title">Total Transactions</div>
                <div class="stat-value">{{ filteredTransactions.length }}</div>
                <div class="stat-desc">From {{ state.transactions.length }} total records</div>
              </div>
            </div>
            
            <div class="stats shadow bg-base-200">
              <div class="stat">
                <div class="stat-title">Total Income</div>
                <div class="stat-value text-success">{{ formatCurrency(calculateTotalIncome(filteredTransactions)) }}</div>
                <div class="stat-desc">{{ calculateCountByType(filteredTransactions, 'income') }} income transactions</div>
              </div>
            </div>
            
            <div class="stats shadow bg-base-200">
              <div class="stat">
                <div class="stat-title">Total Expenses</div>
                <div class="stat-value text-error">{{ formatCurrency(calculateTotalExpenses(filteredTransactions)) }}</div>
                <div class="stat-desc">{{ calculateCountByType(filteredTransactions, 'expense') }} expense transactions</div>
              </div>
            </div>
          </div>
          
          <!-- Transactions Table -->
          <div class="overflow-x-auto bg-base-200 rounded-lg shadow">
            <table class="table table-zebra w-full">
              <!-- Table Header -->
              <thead>
                <tr>
                  <th class="w-12">
                    <label>
                      <input type="checkbox" class="checkbox" v-model="selectAllTransactions" @change="toggleSelectAll" />
                    </label>
                  </th>
                  <th @click="sortTransactions('date')" class="cursor-pointer">
                    Date
                    <span v-if="transactionSort.field === 'date'">
                      {{ transactionSort.direction === 'asc' ? '↑' : '↓' }}
                    </span>
                  </th>
                  <th @click="sortTransactions('description')" class="cursor-pointer">
                    Description
                    <span v-if="transactionSort.field === 'description'">
                      {{ transactionSort.direction === 'asc' ? '↑' : '↓' }}
                    </span>
                  </th>
                  <th @click="sortTransactions('amount')" class="cursor-pointer">
                    Amount
                    <span v-if="transactionSort.field === 'amount'">
                      {{ transactionSort.direction === 'asc' ? '↑' : '↓' }}
                    </span>
                  </th>
                  <th @click="sortTransactions('account')" class="cursor-pointer">
                    Account
                    <span v-if="transactionSort.field === 'account'">
                      {{ transactionSort.direction === 'asc' ? '↑' : '↓' }}
                    </span>
                  </th>
                  <th @click="sortTransactions('accountType')" class="cursor-pointer">
                    Account Type
                    <span v-if="transactionSort.field === 'accountType'">
                      {{ transactionSort.direction === 'asc' ? '↑' : '↓' }}
                    </span>
                  </th>
                  <th @click="sortTransactions('currency')" class="cursor-pointer">
                    Currency
                    <span v-if="transactionSort.field === 'currency'">
                      {{ transactionSort.direction === 'asc' ? '↑' : '↓' }}
                    </span>
                  </th>
                  <th>Category</th>
                  <th>Actions</th>
                </tr>
              </thead>
              
              <!-- Table Body -->
              <tbody>
                <tr v-if="state.loading.transactions">
                  <td colspan="9" class="text-center py-8">
                    <div class="flex justify-center items-center">
                      <span class="loading loading-spinner loading-md mr-2"></span>
                      Loading transactions...
                    </div>
                  </td>
                </tr>
                
                <tr v-else-if="filteredTransactions.length === 0">
                  <td colspan="9" class="text-center py-8">
                    No transactions found. Adjust your filters or upload new transactions.
                  </td>
                </tr>
                
                <tr v-for="tx in paginatedTransactions" :key="tx.id" class="hover">
                  <td>
                    <label>
                      <input type="checkbox" class="checkbox" v-model="selectedTransactions" :value="tx.id" />
                    </label>
                  </td>
                  <td>{{ formatDate(tx.date) }}</td>
                  <td>
                    <div class="flex items-center space-x-3">
                      <div>
                        <div class="font-medium">{{ tx.description }}</div>
                        <div class="text-sm opacity-70">{{ tx.merchant || 'Unknown' }}</div>
                      </div>
                    </div>
                  </td>
                  <td :class="tx.type === 'income' ? 'text-success' : 'text-error'">
                    {{ tx.type === 'income' ? '+' : '-' }} {{ formatCurrency(Math.abs(tx.amount)) }}
                  </td>
                  <td>{{ tx.account || 'Not specified' }}</td>
                  <td>
                    <div class="badge badge-outline">
                      {{ formatAccountType(tx.accountType) }}
                    </div>
                  </td>
                  <td>{{ tx.currency || 'USD' }}</td>
                  <td>
                    <div class="badge" :style="{ backgroundColor: getCategoryColor(tx.categoryId), color: 'white' }">
                      {{ getCategoryName(tx.categoryId) }}
                    </div>
                  </td>
                  <td>
                    <div class="flex space-x-1">
                      <button class="btn btn-xs btn-ghost" @click="editTransaction(tx)">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                        </svg>
                      </button>
                      <button class="btn btn-xs btn-ghost" @click="deleteTransaction(tx.id)">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Pagination Controls -->
          <div class="flex justify-between items-center mt-4">
            <div class="text-sm">
              Showing {{ paginationStart + 1 }} to {{ Math.min(paginationStart + paginationLimit, filteredTransactions.length) }} of {{ filteredTransactions.length }} transactions
            </div>
            <div class="join">
              <button 
                class="join-item btn btn-sm" 
                :disabled="paginationStart === 0"
                @click="previousPage"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                </svg>
              </button>
              <button class="join-item btn btn-sm">Page {{ currentPage }}</button>
              <button 
                class="join-item btn btn-sm" 
                :disabled="paginationStart + paginationLimit >= filteredTransactions.length"
                @click="nextPage"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                </svg>
              </button>
            </div>
          </div>
          
          <!-- Batch Actions -->
          <div v-if="selectedTransactions.length > 0" class="fixed bottom-0 left-0 right-0 bg-base-200 p-4 shadow-lg border-t border-base-300 flex items-center justify-between z-50">
            <div>
              <span class="font-medium">{{ selectedTransactions.length }} transactions selected</span>
            </div>
            <div class="space-x-2">
              <div class="join">
                <select class="select select-bordered join-item" v-model="batchCategoryId">
                  <option disabled value="">Select category</option>
                  <option v-for="category in state.categories" :key="category.id" :value="category.id">
                    {{ category.name }}
                  </option>
                </select>
                <button class="btn join-item btn-primary" @click="applyBatchCategory" :disabled="!batchCategoryId">
                  Apply Category
                </button>
              </div>
              <button class="btn btn-error" @click="deleteBatchTransactions">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                </svg>
                Delete
              </button>
            </div>
          </div>
        </div>
        
        <!-- Categories View -->
        <div v-if="activeTab === 'categories'" class="space-y-6">
          <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">Categories</h1>
            
            <button class="btn btn-primary" @click="openCategoryModal()">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
              </svg>
              Add Category
            </button>
          </div>
          
          <!-- Loading State -->
          <div v-if="state.loading.categories" class="flex justify-center my-8">
            <span class="loading loading-spinner loading-lg text-primary"></span>
          </div>
          
          <!-- Error State -->
          <div v-else-if="state.errors.categories" class="alert alert-error">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <span>{{ state.errors.categories }}</span>
          </div>
          
          <!-- Empty State -->
          <div v-else-if="state.categories.length === 0" class="text-center py-12 bg-base-200 rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 mx-auto text-base-content/50 mb-3">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
            </svg>
            <h3 class="text-lg font-medium mb-2">No Categories Found</h3>
            <p class="text-base-content/70 mb-4">You haven't created any categories yet.</p>
            <button class="btn btn-primary" @click="openCategoryModal()">
              Add Your First Category
            </button>
          </div>
          
          <!-- Categories List -->
          <div v-else>
            <!-- Income Categories -->
            <div class="mb-8">
              <h2 class="text-xl font-semibold mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
                Income Categories
              </h2>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div v-for="category in incomeCategories" :key="category.id" class="card bg-base-100 shadow-sm hover:shadow-md transition-all">
                  <div class="card-body p-4">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full mr-3 flex items-center justify-center text-white" :style="{ backgroundColor: category.color }">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                          </svg>
                        </div>
                        <h3 class="font-medium">{{ category.name }}</h3>
                      </div>
                      <div class="dropdown dropdown-end">
                        <label tabindex="0" class="btn btn-ghost btn-xs">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z" />
                          </svg>
                        </label>
                        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                          <li><a @click="editCategory(category)">Edit</a></li>
                          <li v-if="!category.isDefault"><a @click="deleteCategory(category.id)" class="text-error">Delete</a></li>
                        </ul>
                      </div>
                    </div>
                    <div class="flex justify-between items-center mt-3 text-sm">
                      <span>{{ getCategoryTransactionCount(category.id) }} transactions</span>
                      <span class="font-medium text-success">{{ formatCurrency(getCategoryTotal(category.id)) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Expense Categories -->
            <div>
              <h2 class="text-xl font-semibold mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-error mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0v-8m0 8l-8-8-4 4-6-6" />
                </svg>
                Expense Categories
              </h2>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div v-for="category in expenseCategories" :key="category.id" class="card bg-base-100 shadow-sm hover:shadow-md transition-all">
                  <div class="card-body p-4">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full mr-3 flex items-center justify-center text-white" :style="{ backgroundColor: category.color }">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                          </svg>
                        </div>
                        <h3 class="font-medium">{{ category.name }}</h3>
                      </div>
                      <div class="dropdown dropdown-end">
                        <label tabindex="0" class="btn btn-ghost btn-xs">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z" />
                          </svg>
                        </label>
                        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                          <li><a @click="editCategory(category)">Edit</a></li>
                          <li v-if="!category.isDefault"><a @click="deleteCategory(category.id)" class="text-error">Delete</a></li>
                        </ul>
                      </div>
                    </div>
                    <div class="flex justify-between items-center mt-3 text-sm">
                      <span>{{ getCategoryTransactionCount(category.id) }} transactions</span>
                      <span class="font-medium text-error">{{ formatCurrency(getCategoryTotal(category.id)) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Settings View -->
        <div v-if="activeTab === 'settings'" class="space-y-6">
          <h1 class="text-2xl font-bold mb-6">Settings</h1>
          
          <!-- Loading State -->
          <div v-if="state.loading.settings" class="flex justify-center my-8">
            <span class="loading loading-spinner loading-lg text-primary"></span>
          </div>
          
          <!-- Error State -->
          <div v-else-if="state.errors.settings" class="alert alert-error">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <span>{{ state.errors.settings }}</span>
          </div>
          
          <!-- Settings Form -->
          <div v-else-if="state.settings" class="card bg-base-100 shadow-md">
            <div class="card-body">
              <form @submit.prevent="saveSettings">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- General Settings Section -->
                  <div class="space-y-4">
                    <h3 class="text-lg font-semibold">General Settings</h3>
                    
                    <!-- Currency -->
                    <div class="form-control">
                      <label class="label">
                        <span class="label-text">Currency</span>
                      </label>
                      <select v-model="settingsForm.currency" class="select select-bordered w-full">
                        <option value="USD">USD - US Dollar</option>
                        <option value="EUR">EUR - Euro</option>
                        <option value="GBP">GBP - British Pound</option>
                        <option value="JPY">JPY - Japanese Yen</option>
                        <option value="CAD">CAD - Canadian Dollar</option>
                        <option value="AUD">AUD - Australian Dollar</option>
                      </select>
                    </div>
                    
                    <!-- Locale -->
                    <div class="form-control">
                      <label class="label">
                        <span class="label-text">Locale</span>
                      </label>
                      <select v-model="settingsForm.locale" class="select select-bordered w-full">
                        <option value="en-US">English (US)</option>
                        <option value="en-GB">English (UK)</option>
                        <option value="es-ES">Spanish</option>
                        <option value="fr-FR">French</option>
                        <option value="de-DE">German</option>
                        <option value="ja-JP">Japanese</option>
                      </select>
                    </div>
                    
                    <!-- Date Format -->
                    <div class="form-control">
                      <label class="label">
                        <span class="label-text">Date Format</span>
                      </label>
                      <select v-model="settingsForm.dateFormat" class="select select-bordered w-full">
                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                        <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                      </select>
                    </div>
                    
                    <!-- Theme -->
                    <div class="form-control">
                      <label class="label">
                        <span class="label-text">Theme</span>
                      </label>
                      <select v-model="settingsForm.theme" class="select select-bordered w-full">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                      </select>
                    </div>
                  </div>
                  
                  <!-- Advanced Settings Section -->
                  <div class="space-y-4">
                    <h3 class="text-lg font-semibold">Advanced Settings</h3>
                    
                    <!-- Category Suggestion Confidence -->
                    <div class="form-control">
                      <label class="label">
                        <span class="label-text">Category Suggestion Confidence Threshold</span>
                      </label>
                      <input 
                        type="range" 
                        min="0.5" 
                        max="0.9" 
                        step="0.05" 
                        v-model="settingsForm.categorySuggestionConfidence" 
                        class="range range-primary" 
                      />
                      <div class="flex justify-between text-xs px-2 mt-1">
                        <span>More Suggestions (50%)</span>
                        <span>More Accurate (90%)</span>
                      </div>
                      <div class="text-center mt-1">
                        {{ Math.round(settingsForm.categorySuggestionConfidence * 100) }}%
                      </div>
                    </div>
                    
                    <!-- Default View -->
                    <div class="form-control">
                      <label class="label">
                        <span class="label-text">Default View</span>
                      </label>
                      <select v-model="settingsForm.defaultView" class="select select-bordered w-full">
                        <option value="dashboard">Dashboard</option>
                        <option value="transactions">Transactions</option>
                        <option value="reports">Reports</option>
                      </select>
                    </div>
                    
                    <!-- Budget Start Day -->
                    <div class="form-control">
                      <label class="label">
                        <span class="label-text">Budget Start Day</span>
                      </label>
                      <select v-model="settingsForm.budgetStart" class="select select-bordered w-full">
                        <option v-for="day in 28" :key="day" :value="day">{{ day }}</option>
                      </select>
                      <label class="label">
                        <span class="label-text-alt">Day of month when your budget period starts</span>
                      </label>
                    </div>
                    
                    <!-- Notification Settings -->
                    <div class="form-control">
                      <label class="label">
                        <span class="label-text font-medium">Notifications</span>
                      </label>
                      <label class="label cursor-pointer justify-start gap-3">
                        <input type="checkbox" v-model="settingsForm.notifications.budgetWarnings" class="checkbox checkbox-primary" />
                        <span class="label-text">Budget warnings</span>
                      </label>
                      <label class="label cursor-pointer justify-start gap-3">
                        <input type="checkbox" v-model="settingsForm.notifications.weeklyReports" class="checkbox checkbox-primary" />
                        <span class="label-text">Weekly reports</span>
                      </label>
                      <label class="label cursor-pointer justify-start gap-3">
                        <input type="checkbox" v-model="settingsForm.notifications.emailAlerts" class="checkbox checkbox-primary" />
                        <span class="label-text">Email alerts</span>
                      </label>
                    </div>
                  </div>
                </div>
                
                <div class="form-control mt-6">
                  <button type="submit" class="btn btn-primary" :disabled="state.loading.saveSettings">
                    <span v-if="state.loading.saveSettings" class="loading loading-spinner loading-sm"></span>
                    Save Settings
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        
        <!-- Reports View -->
        <div v-if="activeTab === 'reports'" class="reports-container">
          <!-- Report Controls -->
          <div class="mb-6 flex flex-wrap gap-3 items-center justify-between">
            <h1 class="text-2xl font-bold">Reports & Analytics</h1>
            
            <!-- Date Range Selector -->
            <div class="flex items-center">
              <div class="join">
                <button 
                  class="btn btn-sm join-item"
                  :class="{'btn-primary': selectedDateRange === 'month', 'btn-outline': selectedDateRange !== 'month'}"
                  @click="setDateRange('month')"
                >
                  This Month
                </button>
                <button 
                  class="btn btn-sm join-item"
                  :class="{'btn-primary': selectedDateRange === '3months', 'btn-outline': selectedDateRange !== '3months'}"
                  @click="setDateRange('3months')"
                >
                  3 Months
                </button>
                <button 
                  class="btn btn-sm join-item"
                  :class="{'btn-primary': selectedDateRange === '6months', 'btn-outline': selectedDateRange !== '6months'}"
                  @click="setDateRange('6months')"
                >
                  6 Months
                </button>
                <button 
                  class="btn btn-sm join-item"
                  :class="{'btn-primary': selectedDateRange === 'year', 'btn-outline': selectedDateRange !== 'year'}"
                  @click="setDateRange('year')"
                >
                  Year
                </button>
              </div>
            </div>
          </div>
          
          <!-- Chart Grid -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Monthly Spending by Category Chart -->
            <div class="card bg-base-200 shadow-md">
              <div class="card-body">
                <h2 class="card-title text-lg mb-3">Monthly Spending by Category</h2>
                <div class="chart-container">
                  <canvas id="monthlySpendingChart" height="300"></canvas>
                </div>
              </div>
            </div>
            
            <!-- Spending Trend Over Time Chart -->
            <div class="card bg-base-200 shadow-md">
              <div class="card-body">
                <h2 class="card-title text-lg mb-3">Spending Trend Over Time</h2>
                <div class="chart-container">
                  <canvas id="trendChart" height="300"></canvas>
                </div>
              </div>
            </div>
            
            <!-- Spending by Category Doughnut Chart -->
            <div class="card bg-base-200 shadow-md">
              <div class="card-body">
                <h2 class="card-title text-lg mb-3">Spending by Category (This Month)</h2>
                <div class="chart-container">
                  <canvas id="categoryChart" height="300"></canvas>
                </div>
              </div>
            </div>
            
            <!-- Income vs Expenses Stacked Chart -->
            <div class="card bg-base-200 shadow-md">
              <div class="card-body">
                <h2 class="card-title text-lg mb-3">Income vs Expenses by Month</h2>
                <div class="chart-container">
                  <canvas id="incomeExpensesChart" height="300"></canvas>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Summary Section -->
          <div class="mt-8 card bg-primary text-primary-content">
            <div class="card-body">
              <h2 class="card-title">Financial Summary</h2>
              <div class="mt-2 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-base-100/20 p-4 rounded-lg">
                  <h3 class="font-semibold text-lg">Average Monthly Spending</h3>
                  <p class="text-2xl font-bold">$2,780</p>
                  <p class="text-sm opacity-80">
                    +3.5% compared to previous period
                  </p>
                </div>
                
                <div class="bg-base-100/20 p-4 rounded-lg">
                  <h3 class="font-semibold text-lg">Largest Expense</h3>
                  <p class="text-2xl font-bold">Housing</p>
                  <p class="text-sm opacity-80">
                    $1,200 (35% of total)
                  </p>
                </div>
                
                <div class="bg-base-100/20 p-4 rounded-lg">
                  <h3 class="font-semibold text-lg">Monthly Savings</h3>
                  <p class="text-2xl font-bold">$750</p>
                  <p class="text-sm opacity-80">
                    20% of monthly income
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Category Modal -->
    <div class="modal" :class="{'modal-open': isCategoryModalOpen}">
      <div class="modal-box relative">
        <h3 class="font-bold text-lg mb-4">{{ editingCategoryId ? 'Edit' : 'Add' }} Category</h3>
        
        <form @submit.prevent="saveCategory">
          <!-- Category Name -->
          <div class="form-control mb-4">
            <label class="label">
              <span class="label-text">Name</span>
            </label>
            <input type="text" placeholder="Category name" class="input input-bordered w-full" v-model="categoryForm.name" required />
          </div>
          
          <!-- Category Type -->
          <div class="form-control mb-4">
            <label class="label">
              <span class="label-text">Type</span>
            </label>
            <div class="flex">
              <label class="label cursor-pointer">
                <input type="radio" class="radio radio-primary" value="income" v-model="categoryForm.type" />
                <span class="ml-2 label-text">Income</span>
              </label>
              <label class="label cursor-pointer ml-6">
                <input type="radio" class="radio radio-primary" value="expense" v-model="categoryForm.type" />
                <span class="ml-2 label-text">Expense</span>
              </label>
            </div>
          </div>
          
          <!-- Category Color -->
          <div class="form-control mb-4">
            <label class="label">
              <span class="label-text">Color</span>
            </label>
            <div class="flex flex-wrap gap-2">
              <div
                v-for="color in colorPalette"
                :key="color"
                class="w-8 h-8 rounded-full cursor-pointer border-2 transition-all"
                :class="{ 'border-primary': categoryForm.color === color, 'border-transparent': categoryForm.color !== color }"
                :style="{ backgroundColor: color }"
                @click="categoryForm.color = color"
              ></div>
            </div>
          </div>
          
          <!-- Category Description -->
          <div class="form-control mb-4">
            <label class="label">
              <span class="label-text">Description (Optional)</span>
            </label>
            <textarea placeholder="Enter a description for this category" class="textarea textarea-bordered w-full" v-model="categoryForm.description"></textarea>
          </div>
          
          <div class="modal-action">
            <button type="button" class="btn" @click="closeCategoryModal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Transaction Edit Modal -->
    <div class="modal" :class="{'modal-open': isTransactionModalOpen}">
      <div class="modal-box relative max-w-2xl">
        <h3 class="font-bold text-lg mb-4">{{ editingTransactionId ? 'Edit' : 'Add' }} Transaction</h3>
        
        <form @submit.prevent="saveTransaction">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text">Date</span>
              </label>
              <input type="date" class="input input-bordered" v-model="transactionForm.date" required />
            </div>
            
            <div class="form-control">
              <label class="label">
                <span class="label-text">Amount</span>
              </label>
              <input type="number" step="0.01" class="input input-bordered" v-model.number="transactionForm.amount" required placeholder="0.00" />
            </div>
          </div>
          
          <div class="form-control mt-2">
            <label class="label">
              <span class="label-text">Description</span>
            </label>
            <input type="text" class="input input-bordered" v-model="transactionForm.description" required placeholder="Transaction description" />
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
            <div class="form-control">
              <label class="label">
                <span class="label-text">Transaction Type</span>
              </label>
              <select class="select select-bordered w-full" v-model="transactionForm.type">
                <option value="income">Income</option>
                <option value="expense">Expense</option>
              </select>
            </div>
            
            <div class="form-control">
              <label class="label">
                <span class="label-text">Merchant (Optional)</span>
              </label>
              <input type="text" class="input input-bordered" v-model="transactionForm.merchant" placeholder="e.g. Amazon, Starbucks" />
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
            <div class="form-control">
              <label class="label">
                <span class="label-text">Account</span>
              </label>
              <input type="text" class="input input-bordered" v-model="transactionForm.account" placeholder="e.g. Chase Checking, Amex Platinum" />
            </div>
            
            <div class="form-control">
              <label class="label">
                <span class="label-text">Account Type</span>
              </label>
              <select class="select select-bordered w-full" v-model="transactionForm.accountType">
                <option value="bank">Bank Account</option>
                <option value="credit_card">Credit Card</option>
                <option value="investment">Investment</option>
                <option value="cash">Cash</option>
                <option value="wallet">Digital Wallet</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
            <div class="form-control">
              <label class="label">
                <span class="label-text">Currency</span>
              </label>
              <input type="text" class="input input-bordered" v-model="transactionForm.currency" placeholder="USD" maxlength="3" />
            </div>
            
            <div class="form-control">
              <label class="label">
                <span class="label-text">Category</span>
              </label>
              <select class="select select-bordered w-full" v-model="transactionForm.categoryId">
                <option value="">Uncategorized</option>
                <optgroup label="Income Categories" v-if="getIncomeCategories(state.categories).length">
                  <option v-for="category in getIncomeCategories(state.categories)" :key="category.id" :value="category.id">
                    {{ category.name }}
                  </option>
                </optgroup>
                <optgroup label="Expense Categories" v-if="getExpenseCategories(state.categories).length">
                  <option v-for="category in getExpenseCategories(state.categories)" :key="category.id" :value="category.id">
                    {{ category.name }}
                  </option>
                </optgroup>
              </select>
            </div>
          </div>
          
          <div class="form-control mt-2">
            <label class="label">
              <span class="label-text">Tags (Comma separated)</span>
            </label>
            <input type="text" class="input input-bordered" v-model="transactionForm.tagsInput" placeholder="e.g. vacation, business, recurring" />
          </div>
          
          <div class="form-control mt-2">
            <label class="label">
              <span class="label-text">Notes (Optional)</span>
            </label>
            <textarea class="textarea textarea-bordered" v-model="transactionForm.notes" placeholder="Add notes about this transaction"></textarea>
          </div>
          
          <div class="modal-action">
            <button type="button" class="btn" @click="closeTransactionModal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
      <label class="modal-backdrop" @click="closeTransactionModal"></label>
    </div>
    
    <!-- Transaction Enrichment Modal -->
    <div class="modal" :class="{'modal-open': state.enrichment.showModal}">
      <div class="modal-box relative max-w-4xl">
        <h3 class="font-bold text-lg mb-4">Transaction Enrichment</h3>
        
        <!-- Progress Bar -->
        <div class="w-full mb-6">
          <div class="text-sm mb-1 flex justify-between">
            <span>Progress</span>
            <span>{{ Math.round(state.enrichment.progress) }}%</span>
          </div>
          <div class="w-full bg-base-200 rounded-full h-2.5">
            <div class="bg-primary h-2.5 rounded-full" :style="{width: state.enrichment.progress + '%'}"></div>
          </div>
        </div>
        
        <!-- Steps -->
        <div class="flex justify-center mb-8">
          <ul class="steps steps-horizontal w-full">
            <li class="step" :class="{'step-primary': state.enrichment.progress > 0}">Upload</li>
            <li class="step" :class="{'step-primary': state.enrichment.progress >= 25}">Batching</li>
            <li class="step" :class="{'step-primary': state.enrichment.progress >= 75}">Enrichment</li>
            <li class="step" :class="{'step-primary': state.enrichment.progress === 100}">Complete</li>
          </ul>
        </div>
        
        <!-- Step Content -->
        <div v-if="state.loading.enrichment" class="py-8 text-center">
          <div class="loading loading-spinner loading-lg text-primary"></div>
          <p class="mt-2">Processing transactions...</p>
        </div>
        
        <div v-else-if="state.errors.enrichment" class="alert alert-error mb-4">
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <span>{{ state.errors.enrichment }}</span>
          </div>
        </div>
        
        <div v-else>
          <!-- Batching Step -->
          <div v-if="state.enrichment.currentStep === 'batching'" class="mb-4">
            <h4 class="font-semibold text-md mb-2">Transaction Batches</h4>
            <p class="text-sm mb-4">We've organized your transactions into groups to make them easier to categorize and enrich.</p>
            
            <div class="overflow-x-auto">
              <table class="table w-full">
                <thead>
                  <tr>
                    <th>Batch</th>
                    <th>Transactions</th>
                    <th>Amount</th>
                    <th>Date Range</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(batch, index) in state.enrichment.transactionBatches" :key="batch.batchId">
                    <td>Batch {{ index + 1 }}</td>
                    <td>{{ batch.transactions?.length || batch.transactionCount || 0 }} transactions</td>
                    <td>
                      <span :class="batch.statistics?.netDirection === 'negative' ? 'text-error' : 'text-success'">
                        {{ batch.statistics?.netDirection === 'negative' ? '- ' : '+ ' }}{{ formatCurrency(batch.statistics?.netAmount || 0) }}
                      </span>
                    </td>
                    <td>
                      <span v-if="batch.statistics?.dateRange?.from && batch.statistics?.dateRange?.to">
                        {{ formatDate(batch.statistics.dateRange.from) }} to {{ formatDate(batch.statistics.dateRange.to) }}
                      </span>
                      <span v-else>N/A</span>
                    </td>
                    <td>
                      <button 
                        class="btn btn-sm btn-primary"
                        @click="state.enrichment.currentStep = 'enrichment'; state.enrichment.pendingBatches = [batch.batchId]"
                      >
                        Enrich
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div class="mt-4">
              <div class="stats shadow w-full">
                <div class="stat">
                  <div class="stat-title">Total Transactions</div>
                  <div class="stat-value">{{ state.enrichment.statistics?.totalTransactions || 0 }}</div>
                </div>
                <div class="stat">
                  <div class="stat-title">Total Amount</div>
                  <div class="stat-value" :class="state.enrichment.statistics?.netDirection === 'negative' ? 'text-error' : 'text-success'">
                    {{ state.enrichment.statistics?.netDirection === 'negative' ? '- ' : '+ ' }}{{ formatCurrency(state.enrichment.statistics?.netAmount || 0) }}
                  </div>
                </div>
                <div class="stat">
                  <div class="stat-title">Sources</div>
                  <div class="stat-value text-secondary">{{ state.enrichment.statistics?.sources?.length || 0 }}</div>
                  <div class="stat-desc">{{ state.enrichment.statistics?.sources?.join(', ') }}</div>
                </div>
              </div>
            </div>
            
            <div class="flex justify-end mt-6">
              <button 
                class="btn btn-primary" 
                @click="state.enrichment.currentStep = 'enrichment'; state.enrichment.pendingBatches = state.enrichment.transactionBatches.map(b => b.batchId)"
              >
                Enrich All Batches
              </button>
            </div>
          </div>
          
          <!-- Enrichment Step -->
          <div v-else-if="state.enrichment.currentStep === 'enrichment'" class="mb-4">
            <h4 class="font-semibold text-md mb-2">Enrich Transactions</h4>
            <p class="text-sm mb-4">Add categories and additional information to your transactions.</p>
            
            <div v-if="state.enrichment.pendingBatches && state.enrichment.pendingBatches.length > 0">
              <div class="form-control mb-4">
                <label class="label">
                  <span class="label-text">Category</span>
                </label>
                <select class="select select-bordered w-full" v-model="batchCategoryId">
                  <option value="" disabled>Select a category</option>
                  <optgroup label="Income Categories">
                    <option v-for="category in getIncomeCategories(state.categories)" :key="category.id" :value="category.id">
                      {{ category.name }}
                    </option>
                  </optgroup>
                  <optgroup label="Expense Categories">
                    <option v-for="category in getExpenseCategories(state.categories)" :key="category.id" :value="category.id">
                      {{ category.name }}
                    </option>
                  </optgroup>
                </select>
              </div>
              
              <div class="form-control mb-4">
                <label class="label">
                  <span class="label-text">Tags (comma separated)</span>
                </label>
                <input type="text" class="input input-bordered w-full" placeholder="e.g. vacation, travel, important" v-model="batchTags" />
              </div>
              
              <div class="form-control mb-4">
                <label class="label">
                  <span class="label-text">Notes</span>
                </label>
                <textarea class="textarea textarea-bordered w-full" placeholder="Add notes for these transactions" v-model="batchNotes"></textarea>
              </div>
              
              <div class="alert alert-info mb-4">
                <div>
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current flex-shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                  <span>These changes will apply to <strong>{{ state.enrichment.pendingBatches.length }}</strong> batch(es) containing multiple transactions.</span>
                </div>
              </div>
              
              <div class="flex justify-end mt-6 space-x-2">
                <button class="btn" @click="state.enrichment.currentStep = 'batching'; state.enrichment.pendingBatches = []">
                  Back to Batches
                </button>
                <button 
                  class="btn btn-primary" 
                  @click="applyEnrichmentToBatches()"
                  :disabled="!batchCategoryId"
                >
                  Apply Changes
                </button>
              </div>
            </div>
            
            <div v-else>
              <div class="alert alert-success mb-4">
                <div>
                  <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                  <span>All batches have been enriched!</span>
                </div>
              </div>
              
              <div class="flex justify-end mt-6">
                <button class="btn" @click="state.enrichment.currentStep = 'batching'">
                  Back to Batches
                </button>
                <button class="btn btn-primary ml-2" @click="completeUpload(state.enrichment.currentUploadId)">
                  Complete Import
                </button>
              </div>
            </div>
          </div>
          
          <!-- Complete Step -->
          <div v-else-if="state.enrichment.currentStep === 'complete'" class="mb-4 text-center py-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-success mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h4 class="font-bold text-xl mb-2">Import Complete!</h4>
            <p class="mb-6">Your transactions have been successfully imported and enriched.</p>
            
            <div class="stats shadow mx-auto">
              <div class="stat">
                <div class="stat-title">Transactions Imported</div>
                <div class="stat-value">{{ state.enrichment.statistics?.totalTransactions || 0 }}</div>
              </div>
              <div class="stat">
                <div class="stat-title">Total Amount</div>
                <div class="stat-value" :class="state.enrichment.statistics?.netDirection === 'negative' ? 'text-error' : 'text-success'">
                  {{ state.enrichment.statistics?.netDirection === 'negative' ? '- ' : '+ ' }}{{ formatCurrency(state.enrichment.statistics?.netAmount || 0) }}
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-action">
          <button type="button" class="btn" @click="closeEnrichmentModal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // API Service Functions
    const api = {
      // Base API URLs
      baseUrl: '/api',
      
      // Generic request handler
      async request(endpoint, method = 'GET', data = null) {
        const url = `${this.baseUrl}${endpoint}`;
        const options = {
          method,
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          }
        };
        
        if (data && (method === 'POST' || method === 'PUT')) {
          options.body = JSON.stringify(data);
        }
        
        try {
          const response = await fetch(url, options);
          
          if (!response.ok) {
            throw new Error(`API error: ${response.status} ${response.statusText}`);
          }
          
          // For 204 No Content responses (like from DELETE), return an empty object
          if (response.status === 204) {
            return {};
          }
          
          return await response.json();
        } catch (error) {
          console.error('API request failed:', error);
          throw error;
        }
      },
      
      // Transactions API
      transactions: {
        async getAll() {
          return api.request('/transactions');
        },
        
        async getById(id) {
          return api.request(`/transactions/${id}`);
        },
        
        async create(transaction) {
          return api.request('/transactions', 'POST', transaction);
        },
        
        async update(id, transaction) {
          return api.request(`/transactions/${id}`, 'PUT', transaction);
        },
        
        async delete(id) {
          return api.request(`/transactions/${id}`, 'DELETE');
        },
        
        async batchUpdateCategory(transactionIds, categoryId) {
          return api.request('/transactions/batch-categorize', 'POST', { 
            transactionIds, 
            categoryId 
          });
        },
        
        // Alias for batchUpdateCategory for better naming consistency
        async updateCategory(transactionIds, categoryId) {
          return this.batchUpdateCategory(transactionIds, categoryId);
        },
        
        async uploadFile(formData) {
          const url = `${api.baseUrl}/transactions/upload`;
          
          try {
            const response = await fetch(url, {
              method: 'POST',
              body: formData // No Content-Type header for multipart/form-data
            });
            
            if (!response.ok) {
              throw new Error(`Upload failed: ${response.status} ${response.statusText}`);
            }
            
            return await response.json();
          } catch (error) {
            console.error('File upload failed:', error);
            throw error;
          }
        }
      },
      
      // Categories API
      categories: {
        async getAll() {
          return api.request('/categories');
        },
        
        async getById(id) {
          return api.request(`/categories/${id}`);
        },
        
        async create(category) {
          return api.request('/categories', 'POST', category);
        },
        
        async update(id, category) {
          return api.request(`/categories/${id}`, 'PUT', category);
        },
        
        async delete(id) {
          return api.request(`/categories/${id}`, 'DELETE');
        }
      },
      
      // Reports API
      reports: {
        async getDashboard() {
          return api.request('/reports/dashboard');
        },
        
        async getCategorySummary(timeframe = 'month') {
          return api.request(`/reports/category-summary?timeframe=${timeframe}`);
        },
        
        async getSpendingTrend(timeframe = '6months') {
          return api.request(`/reports/spending-trend?timeframe=${timeframe}`);
        },
        
        async getMonthlyFinances(months = 6) {
          return api.request(`/reports/monthly-finances?months=${months}`);
        },
        
        async getBudgetStatus() {
          return api.request('/reports/budget-status');
        }
      },
      
      // Settings API
      settings: {
        async get() {
          return api.request('/settings');
        },
        
        async update(settings) {
          return api.request('/settings', 'PUT', settings);
        }
      }
    };

    // Create Vue App
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue;
    
    createApp({
      setup() {
        // State management
        const state = reactive({
          transactions: [],
          categories: [],
          reportData: {
            categorySummary: [],
            spendingTrend: [],
            monthlyFinances: []
          },
          // New dashboard-specific state
          dashboardData: null,
          incomeVsExpenses: { income: 0, expenses: 0, net: 0, savingsRate: 0 },
          categorizationStatus: { total: 0, categorized: 0, uncategorized: 0, percentage: 0 },
          topMerchants: [],
          recentTransactions: [],
          budgetStatus: null,
          settings: null,
          loading: {
            transactions: false,
            categories: false,
            reports: false,
            upload: false,
            saveSettings: false,
            enrichment: false
          },
          successMessages: {
            upload: null,
            enrichment: null
          },
          errors: {
            transactions: null,
            categories: null,
            reports: null,
            settings: null,
            upload: null,
            enrichment: null
          },
          // Enrichment flow state
          enrichment: {
            showModal: false,
            currentUploadId: null,
            transactionBatches: [],
            processedBatches: [],
            pendingBatches: [],
            currentStep: 'batching', // 'upload', 'batching', 'enrichment', 'complete'
            progress: 0,
            statistics: {
              totalTransactions: 0,
              netAmount: 0,
              sources: []
            }
          }
        });
        
        const hasData = ref(false);
        const isUploadActive = ref(false);
        const uploadProgress = ref(0);
        const activeTab = ref('home');
        const selectedDateRange = ref('month');
        
        // Transaction filtering and pagination
        const transactionSearchQuery = ref('');
        const selectedTransactions = ref([]);
        const selectAllTransactions = ref(false);
        const transactionTypeFilter = ref('all'); // all, income, expense
        const transactionDateFilter = ref('all'); // all, thisMonth, last3Months, custom
        const categoryFilter = ref('all'); // all, uncategorized, or category ID
        const paginationStart = ref(0);
        const paginationLimit = ref(20);
        const transactionSort = reactive({
          field: 'date',
          direction: 'desc'
        });
        const isFilterDropdownOpen = ref(false);
        
        // Batch actions
        const batchCategoryId = ref('');
        const batchTags = ref('');
        const batchNotes = ref('');
        const isBatchCategoryModalOpen = ref(false);
        
        // Category management
        const isCategoryModalOpen = ref(false);
        const editingCategoryId = ref(null);
        const categoryForm = reactive({
          name: '',
          type: 'expense',
          color: '#6366F1', // Default color (indigo)
          description: ''
        });
        
        // for transaction modal
        const isTransactionModalOpen = ref(false);
        const editingTransactionId = ref(null);
        const transactionForm = reactive({
          date: new Date().toISOString().split('T')[0],
          description: '',
          amount: 0,
          type: 'expense',
          merchant: '',
          account: '',
          accountType: 'bank',
          currency: 'USD',
          categoryId: '',
          tagsInput: '',
          notes: ''
        });
        const colorPalette = [
          '#EF4444', // Red
          '#F97316', // Orange  
          '#F59E0B', // Amber
          '#EAB308', // Yellow
          '#84CC16', // Lime
          '#22C55E', // Green
          '#10B981', // Emerald
          '#14B8A6', // Teal
          '#06B6D4', // Cyan
          '#0EA5E9', // Light Blue
          '#3B82F6', // Blue
          '#6366F1', // Indigo
          '#8B5CF6', // Violet
          '#A855F7', // Purple
          '#D946EF', // Fuchsia
          '#EC4899', // Pink
          '#F43F5E', // Rose
          '#64748B'  // Slate
        ];
        
        // Fetch transactions from API
        const fetchTransactions = async () => {
          state.loading.transactions = true;
          state.errors.transactions = null;
          
          try {
            state.transactions = await api.transactions.getAll();
            if (state.transactions.length > 0) {
              hasData.value = true;
            }
          } catch (error) {
            state.errors.transactions = error.message;
            console.error('Failed to fetch transactions:', error);
          } finally {
            state.loading.transactions = false;
          }
        };
        
        // Fetch categories from API
        const fetchCategories = async () => {
          state.loading.categories = true;
          state.errors.categories = null;
          
          try {
            state.categories = await api.categories.getAll();
          } catch (error) {
            state.errors.categories = error.message;
            console.error('Failed to fetch categories:', error);
          } finally {
            state.loading.categories = false;
          }
        };
        
        // Fetch dashboard data
        const fetchDashboardData = async () => {
          state.loading.reports = true;
          state.errors.reports = null;
          
          try {
            const dashboardData = await api.reports.getDashboard();
            
            // Store dashboard data in the state
            state.dashboardData = dashboardData;
            
            // Update other state properties based on dashboard data
            if (dashboardData.incomeVsExpenses) {
              state.incomeVsExpenses = dashboardData.incomeVsExpenses;
            }
            
            if (dashboardData.topMerchants) {
              state.topMerchants = dashboardData.topMerchants;
            }
            
            if (dashboardData.recentTransactions) {
              state.recentTransactions = dashboardData.recentTransactions;
            }
            
            if (dashboardData.categorization) {
              state.categorizationStatus = dashboardData.categorization;
            }
            
            console.log('Dashboard data loaded:', dashboardData);
          } catch (error) {
            state.errors.reports = error.message;
            console.error('Failed to fetch dashboard data:', error);
          } finally {
            state.loading.reports = false;
          }
        };
        
        // Fetch report data based on selected timeframe
        const fetchReportData = async () => {
          state.loading.reports = true;
          state.errors.reports = null;
          
          try {
            // Fetch category summary data
            state.reportData.categorySummary = await api.reports.getCategorySummary(selectedDateRange.value);
            
            // Fetch spending trend data
            state.reportData.spendingTrend = await api.reports.getSpendingTrend(selectedDateRange.value);
            
            // Fetch monthly finance data
            const months = selectedDateRange.value === 'month' ? 1 :
                          selectedDateRange.value === '3months' ? 3 :
                          selectedDateRange.value === '6months' ? 6 : 12;
            state.reportData.monthlyFinances = await api.reports.getMonthlyFinances(months);
            
            // Fetch budget status
            state.budgetStatus = await api.reports.getBudgetStatus();
          } catch (error) {
            state.errors.reports = error.message;
            console.error('Failed to fetch report data:', error);
          } finally {
            state.loading.reports = false;
          }
        };
        
        // Fetch settings from API
        const fetchSettings = async () => {
          state.loading.settings = true;
          state.errors.settings = null;
          
          try {
            state.settings = await api.settings.get();
          } catch (error) {
            state.errors.settings = error.message;
            console.error('Failed to fetch settings:', error);
          } finally {
            state.loading.settings = false;
          }
        };
        
        // Handle file drop (drag & drop)
        const handleFileDrop = async (event) => {
          if (event.dataTransfer.files && event.dataTransfer.files.length > 0) {
            const file = event.dataTransfer.files[0];
            await processFileUpload(file);
          }
        };
        
        // Handle file upload from input field
        const handleFileUpload = async (event) => {
          const file = event.target.files[0];
          if (!file) return;
          
          await processFileUpload(file);
        };
        
        // Process file upload (used by both drag & drop and file input)
        const processFileUpload = async (file) => {
          state.loading.upload = true;
          state.errors.upload = null;
          state.successMessages.upload = null;
          uploadProgress.value = 10;
          
          try {
            const formData = new FormData();
            formData.append('file', file);
            
            // Add enrichment mode flag to enable the new flow
            formData.append('enrichMode', 'true');
            
            // Simulate progress (in a real app, this would use progress events)
            let progressInterval = setInterval(() => {
              if (uploadProgress.value < 90) {
                uploadProgress.value += 10;
              } else {
                clearInterval(progressInterval);
              }
            }, 300);
            
            const result = await api.transactions.uploadFile(formData);
            
            // Clear interval and set to 100%
            clearInterval(progressInterval);
            uploadProgress.value = 100;
            
            // If result has uploadId and enrichmentMode=true, start the enrichment flow
            if (result.uploadId && result.enrichmentMode) {
              // Update state to show enrichment modal
              state.enrichment.showModal = true;
              state.enrichment.currentUploadId = result.uploadId;
              state.enrichment.transactionBatches = result.batches || [];
              state.enrichment.statistics = result.statistics;
              state.enrichment.currentStep = 'batching';
              state.enrichment.progress = 25; // First step completed
              
              // Show success message specifically for enrichment mode
              state.successMessages.upload = `Successfully uploaded ${file.name}. Starting transaction enrichment flow...`;
            } else {
              // Traditional flow - no enrichment
              // Refresh transactions after upload
              await fetchTransactions();
              
              hasData.value = true;
              
              // Show success message
              state.successMessages.upload = `Successfully uploaded ${file.name}. ${result.count || 'Multiple'} transactions imported.`;
            }
            
            // Reset upload progress after a delay
            setTimeout(() => {
              uploadProgress.value = 0;
              
              // Clear success message after 5 seconds
              setTimeout(() => {
                state.successMessages.upload = null;
              }, 5000);
            }, 2000);
            
            return result;
          } catch (error) {
            state.errors.upload = error.message;
            console.error('File upload failed:', error);
            uploadProgress.value = 0;
          } finally {
            state.loading.upload = false;
          }
        };
        
        // Fetch enrichment batches
        const fetchEnrichmentBatches = async (uploadId) => {
          state.loading.enrichment = true;
          state.errors.enrichment = null;
          
          try {
            const result = await api.transactions.getUploadedBatches(uploadId);
            state.enrichment.transactionBatches = result.batches || [];
            state.enrichment.statistics = result.statistics;
            return result;
          } catch (error) {
            state.errors.enrichment = error.message;
            console.error('Failed to fetch enrichment batches:', error);
          } finally {
            state.loading.enrichment = false;
          }
        };
        
        // Enrich a batch of transactions
        const enrichBatch = async (batchId, enrichData) => {
          state.loading.enrichment = true;
          state.errors.enrichment = null;
          
          try {
            const result = await api.transactions.batchEnrich(batchId, enrichData);
            
            // Update the batch in the state
            const batchIndex = state.enrichment.transactionBatches.findIndex(b => b.batchId === batchId);
            if (batchIndex !== -1) {
              state.enrichment.transactionBatches[batchIndex] = result;
            }
            
            // Move the batch from pending to processed
            state.enrichment.processedBatches.push(batchId);
            state.enrichment.pendingBatches = state.enrichment.pendingBatches.filter(id => id !== batchId);
            
            // Update progress
            updateEnrichmentProgress();
            
            return result;
          } catch (error) {
            state.errors.enrichment = error.message;
            console.error('Failed to enrich batch:', error);
          } finally {
            state.loading.enrichment = false;
          }
        };
        
        // Complete a batch of transactions
        const completeBatch = async (batchId) => {
          state.loading.enrichment = true;
          
          try {
            await api.transactions.completeBatch(batchId);
            
            // Move the batch to completed status
            const batchIndex = state.enrichment.transactionBatches.findIndex(b => b.batchId === batchId);
            if (batchIndex !== -1) {
              const updatedBatch = { ...state.enrichment.transactionBatches[batchIndex], status: 'completed' };
              state.enrichment.transactionBatches[batchIndex] = updatedBatch;
            }
            
            // Update progress
            updateEnrichmentProgress();
          } catch (error) {
            console.error('Failed to complete batch:', error);
          } finally {
            state.loading.enrichment = false;
          }
        };
        
        // Complete the entire upload
        const completeUpload = async (uploadId) => {
          state.loading.enrichment = true;
          
          try {
            await api.transactions.completeUpload(uploadId);
            
            // Set the enrichment flow as complete
            state.enrichment.currentStep = 'complete';
            state.enrichment.progress = 100;
            
            // Refresh transactions to show the newly imported data
            await fetchTransactions();
            
            // Fetch categories if they might have been updated
            await fetchCategories();
            
            hasData.value = true;
            
            // Show success message
            state.successMessages.enrichment = `Successfully imported and enriched all transactions.`;
            
            // Clear enrichment modal after a delay
            setTimeout(() => {
              closeEnrichmentModal();
            }, 3000);
          } catch (error) {
            console.error('Failed to complete upload:', error);
          } finally {
            state.loading.enrichment = false;
          }
        };
        
        // Update the enrichment progress
        const updateEnrichmentProgress = () => {
          const totalBatches = state.enrichment.transactionBatches.length;
          if (totalBatches === 0) return;
          
          const completedBatches = state.enrichment.transactionBatches.filter(b => 
            b.status === 'completed' || b.status === 'enriched').length;
          
          // Calculate progress percentage (25% for upload, 75% for batches)
          const batchProgress = completedBatches / totalBatches * 75;
          state.enrichment.progress = 25 + batchProgress;
          
          // Update step if all batches are completed
          if (completedBatches === totalBatches) {
            state.enrichment.currentStep = 'complete';
            state.enrichment.progress = 100;
          }
        };
        
        // Close the enrichment modal
        const closeEnrichmentModal = () => {
          state.enrichment.showModal = false;
          state.enrichment.currentUploadId = null;
          state.enrichment.transactionBatches = [];
          state.enrichment.processedBatches = [];
          state.enrichment.pendingBatches = [];
          state.enrichment.currentStep = 'batching';
          state.enrichment.progress = 0;
          state.enrichment.statistics = null;
        };
        
        // Apply enrichment to selected batches
        const applyEnrichmentToBatches = async () => {
          if (!state.enrichment.pendingBatches || state.enrichment.pendingBatches.length === 0) {
            return;
          }
          
          state.loading.enrichment = true;
          state.errors.enrichment = null;
          
          try {
            // Build the enrichment data
            const enrichData = {
              categoryId: batchCategoryId.value,
              tags: batchTags.value ? batchTags.value.split(',').map(t => t.trim()) : [],
              notes: batchNotes.value
            };
            
            // Process each pending batch
            const enrichPromises = state.enrichment.pendingBatches.map(batchId => 
              enrichBatch(batchId, enrichData)
            );
            
            // Wait for all batches to be processed
            await Promise.all(enrichPromises);
            
            // Update progress
            updateEnrichmentProgress();
            
            // Clear form
            batchCategoryId.value = '';
            batchTags.value = '';
            batchNotes.value = '';
            
            // Show success message
            state.successMessages.enrichment = `Successfully enriched ${state.enrichment.pendingBatches.length} batch(es).`;
            
            // Clear pending batches
            state.enrichment.pendingBatches = [];
            
            // If all batches are processed, move to complete step
            const areAllBatchesProcessed = state.enrichment.transactionBatches.every(
              batch => batch.status === 'completed' || batch.status === 'enriched'
            );
            
            if (areAllBatchesProcessed) {
              state.enrichment.currentStep = 'complete';
              state.enrichment.progress = 100;
            }
          } catch (error) {
            state.errors.enrichment = error.message || 'Failed to apply enrichment';
            console.error('Failed to apply enrichment:', error);
          } finally {
            state.loading.enrichment = false;
          }
        };
        
        // Use sample data (for development/demo)
        const useSampleData = () => {
          hasData.value = true;
          uploadProgress.value = 60;
          
          // Simulate API call delay
          setTimeout(() => {
            uploadProgress.value = 100;
            
            // Reset upload progress after delay
            setTimeout(() => {
              uploadProgress.value = 0;
            }, 2000);
          }, 1500);
        };
        
        const setUploadActive = (active) => {
          isUploadActive.value = active;
        };
        
        // Handle date range selection
        const setDateRange = (range) => {
          selectedDateRange.value = range;
          fetchReportData();
        };
        
        // Initialize data on component mount
        onMounted(async () => {
          try {
            // Fetch initial data in parallel
            await Promise.all([
              fetchCategories(),
              fetchTransactions()
            ]);
            
            // Fetch report data after we have categories and transactions
            if (hasData.value) {
              // Fetch both dashboard and report data
              await Promise.all([
                fetchDashboardData(),
                fetchReportData()
              ]);
            } else {
              // Even with no transactions, try to fetch dashboard data
              await fetchDashboardData();
            }
            
            // Fetch settings
            await fetchSettings();
          } catch (error) {
            console.error('Error initializing app data:', error);
          }
        });
        
        // Watch for tab changes
        watch(activeTab, (newTab) => {
          if (newTab === 'reports' && hasData.value) {
            fetchReportData();
          } else if (newTab === 'home') {
            // Refresh dashboard data when returning to home tab
            fetchDashboardData();
          }
        });
        
        // Transaction management functions
        
        // Format date for display
        const formatDate = (dateString) => {
          if (!dateString) return 'N/A';
          const date = new Date(dateString);
          return new Intl.DateTimeFormat('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
          }).format(date);
        };
        
        // Format currency for display
        const formatCurrency = (amount) => {
          if (amount === undefined || amount === null) return '$0.00';
          return new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD'
          }).format(amount);
        };
        
        // Get category name by ID
        const getCategoryName = (categoryId) => {
          if (!categoryId) return 'Uncategorized';
          const category = state.categories.find(c => c.id === categoryId);
          return category ? category.name : 'Uncategorized';
        };
        
        // Get category color by ID
        const getCategoryColor = (categoryId) => {
          if (!categoryId) return '#718096'; // Default gray color
          const category = state.categories.find(c => c.id === categoryId);
          return category ? category.color : '#718096';
        };
        
        // Format account type for display
        const formatAccountType = (accountType) => {
          if (!accountType) return 'Unknown';
          
          // Convert snake_case to Title Case
          const mapping = {
            'bank': 'Bank Account',
            'credit_card': 'Credit Card',
            'investment': 'Investment',
            'cash': 'Cash',
            'wallet': 'Digital Wallet',
            'other': 'Other'
          };
          
          return mapping[accountType] || accountType.charAt(0).toUpperCase() + accountType.slice(1).replace(/_/g, ' ');
        };
        
        // Filter transactions based on search query and filters
        const filterTransactions = () => {
          // Reset pagination when filter changes
          paginationStart.value = 0;
          // Close the filter dropdown
          isFilterDropdownOpen.value = false;
        };
        
        // Toggle filter dropdown
        const toggleFilterDropdown = () => {
          isFilterDropdownOpen.value = !isFilterDropdownOpen.value;
          // Add event listener to close dropdown when clicking outside
          if (isFilterDropdownOpen.value) {
            setTimeout(() => {
              document.addEventListener('click', closeFilterDropdown);
            }, 0);
          }
        };
        
        // Close filter dropdown when clicking outside
        const closeFilterDropdown = (event) => {
          if (isFilterDropdownOpen.value) {
            isFilterDropdownOpen.value = false;
            document.removeEventListener('click', closeFilterDropdown);
          }
        };
        
        // Set category filter
        const setCategoryFilter = (categoryId) => {
          categoryFilter.value = categoryId;
          filterTransactions();
        };
        
        // Open batch category modal
        const openBatchCategoryModal = () => {
          // Select all uncategorized transactions
          selectedTransactions.value = state.transactions
            .filter(tx => !tx.categoryId)
            .map(tx => tx.id);
          
          // If there are any selected transactions, show the batch action bar
          if (selectedTransactions.value.length > 0) {
            // Scroll to the transactions table
            document.querySelector('.transactions-container').scrollIntoView({ behavior: 'smooth' });
          } else {
            alert('No uncategorized transactions found.');
          }
        };
        
        // Computed property for filtered transactions
        const filteredTransactions = computed(() => {
          if (!state.transactions.length) return [];
          
          return state.transactions.filter(tx => {
            // Search query filter
            const searchMatches = !transactionSearchQuery.value || 
              tx.description?.toLowerCase().includes(transactionSearchQuery.value.toLowerCase()) ||
              tx.merchant?.toLowerCase().includes(transactionSearchQuery.value.toLowerCase());
            
            // Transaction type filter
            const typeMatches = transactionTypeFilter.value === 'all' || 
              tx.type === transactionTypeFilter.value;
            
            // Date filter
            let dateMatches = true;
            if (transactionDateFilter.value === 'thisMonth') {
              const now = new Date();
              const txDate = new Date(tx.date);
              dateMatches = txDate.getMonth() === now.getMonth() && 
                txDate.getFullYear() === now.getFullYear();
            } else if (transactionDateFilter.value === 'last3Months') {
              const now = new Date();
              const threeMonthsAgo = new Date();
              threeMonthsAgo.setMonth(now.getMonth() - 3);
              const txDate = new Date(tx.date);
              dateMatches = txDate >= threeMonthsAgo;
            }
            
            // Category filter
            let categoryMatches = true;
            if (categoryFilter.value === 'uncategorized') {
              categoryMatches = !tx.categoryId;
            } else if (categoryFilter.value !== 'all') {
              categoryMatches = tx.categoryId === categoryFilter.value;
            }
            
            return searchMatches && typeMatches && dateMatches && categoryMatches;
          });
        });
        
        // Sort transactions
        const sortTransactions = (field) => {
          if (transactionSort.field === field) {
            // If already sorting by this field, toggle direction
            transactionSort.direction = transactionSort.direction === 'asc' ? 'desc' : 'asc';
          } else {
            // Otherwise, sort by the new field in ascending order
            transactionSort.field = field;
            transactionSort.direction = 'asc';
          }
        };
        
        // Computed property for sorted and filtered transactions
        const sortedTransactions = computed(() => {
          const transactions = [...filteredTransactions.value];
          
          return transactions.sort((a, b) => {
            let comparison = 0;
            
            if (transactionSort.field === 'date') {
              comparison = new Date(a.date) - new Date(b.date);
            } else if (transactionSort.field === 'amount') {
              comparison = a.amount - b.amount;
            } else if (transactionSort.field === 'description') {
              comparison = a.description.localeCompare(b.description);
            } else if (transactionSort.field === 'account') {
              comparison = (a.account || '').localeCompare(b.account || '');
            } else if (transactionSort.field === 'accountType') {
              comparison = (a.accountType || '').localeCompare(b.accountType || '');
            } else if (transactionSort.field === 'currency') {
              comparison = (a.currency || 'USD').localeCompare(b.currency || 'USD');
            }
            
            return transactionSort.direction === 'asc' ? comparison : -comparison;
          });
        });
        
        // Computed property for paginated transactions
        const paginatedTransactions = computed(() => {
          return sortedTransactions.value.slice(
            paginationStart.value,
            paginationStart.value + paginationLimit.value
          );
        });
        
        // Computed property for current page number
        const currentPage = computed(() => {
          return Math.floor(paginationStart.value / paginationLimit.value) + 1;
        });
        
        // Toggle select all transactions
        const toggleSelectAll = () => {
          if (selectAllTransactions.value) {
            selectedTransactions.value = filteredTransactions.value.map(tx => tx.id);
          } else {
            selectedTransactions.value = [];
          }
        };
        
        // Calculate total income from transactions
        const calculateTotalIncome = (transactions) => {
          return transactions
            .filter(tx => tx.type === 'income')
            .reduce((sum, tx) => sum + (tx.amount || 0), 0);
        };
        
        // Calculate total expenses from transactions
        const calculateTotalExpenses = (transactions) => {
          return transactions
            .filter(tx => tx.type === 'expense')
            .reduce((sum, tx) => sum + Math.abs(tx.amount || 0), 0);
        };
        
        // Count transactions by type
        const calculateCountByType = (transactions, type) => {
          return transactions.filter(tx => tx.type === type).length;
        };
        
        // Set transaction type filter
        const setTransactionTypeFilter = (type) => {
          transactionTypeFilter.value = type;
          filterTransactions();
        };
        
        // Set transaction date filter
        const setTransactionDateFilter = (dateFilter) => {
          transactionDateFilter.value = dateFilter;
          filterTransactions();
        };
        
        // Handle pagination - go to previous page
        const previousPage = () => {
          if (paginationStart.value >= paginationLimit.value) {
            paginationStart.value -= paginationLimit.value;
          }
        };
        
        // Handle pagination - go to next page
        const nextPage = () => {
          if (paginationStart.value + paginationLimit.value < filteredTransactions.value.length) {
            paginationStart.value += paginationLimit.value;
          }
        };
        
        // Open modal for batch categorization
        // Category management functions
        
        // Open the category modal for creating a new category
        const openCategoryModal = (categoryId = null) => {
          // Reset the form
          categoryForm.name = '';
          categoryForm.type = 'expense';
          categoryForm.color = '#6366F1'; // Default indigo color
          categoryForm.description = '';
          
          // If editing an existing category, load its data
          if (categoryId) {
            editingCategoryId.value = categoryId;
            const category = state.categories.find(c => c.id === categoryId);
            if (category) {
              categoryForm.name = category.name;
              categoryForm.type = category.type;
              categoryForm.color = category.color;
              categoryForm.description = category.description || '';
            }
          } else {
            editingCategoryId.value = null;
          }
          
          // Open the modal
          isCategoryModalOpen.value = true;
        };
        
        // Close the category modal
        const closeCategoryModal = () => {
          isCategoryModalOpen.value = false;
        };
        
        // Save a category (create new or update existing)
        const saveCategory = async () => {
          try {
            if (editingCategoryId.value) {
              // Update existing category
              await api.categories.update(editingCategoryId.value, categoryForm);
            } else {
              // Create new category
              await api.categories.create(categoryForm);
            }
            
            // Refresh categories list
            await fetchCategories();
            
            // Close the modal
            closeCategoryModal();
          } catch (error) {
            console.error('Failed to save category:', error);
            state.errors.categories = error.message;
          }
        };
        
        // Delete a category
        const deleteCategory = async (categoryId) => {
          if (!confirm('Are you sure you want to delete this category? This will not delete transactions, but will remove the category from them.')) {
            return;
          }
          
          try {
            await api.categories.delete(categoryId);
            await fetchCategories();
          } catch (error) {
            console.error('Failed to delete category:', error);
            state.errors.categories = error.message;
          }
        };
        
        // Edit category - Open modal with existing category data
        const editCategory = (category) => {
          openCategoryModal(category.id);
        };
        
        // Transaction editing functions
        const editTransaction = (transaction) => {
          editingTransactionId.value = transaction.id;
          
          // Convert from ISO date string to YYYY-MM-DD
          const isoDate = new Date(transaction.date);
          const formattedDate = isoDate.toISOString().split('T')[0];
          
          // Map transaction data to form
          transactionForm.date = formattedDate;
          transactionForm.description = transaction.description;
          transactionForm.amount = Math.abs(transaction.amount);
          transactionForm.type = transaction.type;
          transactionForm.merchant = transaction.merchant || '';
          transactionForm.account = transaction.account || '';
          transactionForm.accountType = transaction.accountType || 'bank';
          transactionForm.currency = transaction.currency || 'USD';
          transactionForm.categoryId = transaction.categoryId || '';
          transactionForm.notes = transaction.notes || '';
          
          // Convert tags array to comma-separated string
          if (transaction.tags && Array.isArray(transaction.tags)) {
            transactionForm.tagsInput = transaction.tags.join(', ');
          } else {
            transactionForm.tagsInput = '';
          }
          
          // Open the modal
          isTransactionModalOpen.value = true;
        };
        
        const closeTransactionModal = () => {
          isTransactionModalOpen.value = false;
        };
        
        const saveTransaction = async () => {
          try {
            // Convert tags input to array
            const tags = transactionForm.tagsInput
              ? transactionForm.tagsInput.split(',').map(tag => tag.trim())
              : [];
            
            // Create transaction object from form data
            // Always use absolute value for amount - the type field determines income/expense
            const transaction = {
              date: transactionForm.date,
              description: transactionForm.description,
              amount: Math.abs(transactionForm.amount),
              type: transactionForm.type,
              merchant: transactionForm.merchant || null,
              account: transactionForm.account || null,
              accountType: transactionForm.accountType,
              currency: transactionForm.currency,
              categoryId: transactionForm.categoryId || null,
              tags: tags,
              notes: transactionForm.notes || null
            };
            
            if (editingTransactionId.value) {
              // Update existing transaction
              await api.transactions.update(editingTransactionId.value, transaction);
            } else {
              // Create new transaction
              await api.transactions.create(transaction);
            }
            
            // Refresh transactions list
            await fetchTransactions();
            
            // Close the modal
            closeTransactionModal();
          } catch (error) {
            console.error('Failed to save transaction:', error);
            state.errors.transactions = error.message;
          }
        };
        
        // Get income categories only
        const incomeCategories = computed(() => {
          return state.categories.filter(category => category.type === 'income');
        });
        
        // Get expense categories only
        const expenseCategories = computed(() => {
          return state.categories.filter(category => category.type === 'expense');
        });
        
        // Get transaction count for a category
        const getCategoryTransactionCount = (categoryId) => {
          return state.transactions.filter(tx => tx.categoryId === categoryId).length;
        };
        
        // Get total amount for a category
        const getCategoryTotal = (categoryId) => {
          return state.transactions
            .filter(tx => tx.categoryId === categoryId)
            .reduce((sum, tx) => sum + (tx.amount || 0), 0);
        };
        
        // Apply category to multiple transactions
        const applyBatchCategory = async () => {
          if (!batchCategoryId.value || selectedTransactions.value.length === 0) {
            return;
          }
          
          try {
            await api.transactions.updateCategory(selectedTransactions.value, batchCategoryId.value);
            
            // Refresh transactions to show new categories
            await fetchTransactions();
            
            // Clear selection
            selectedTransactions.value = [];
            selectAllTransactions.value = false;
            batchCategoryId.value = '';
          } catch (error) {
            console.error('Failed to update categories:', error);
            state.errors.transactions = error.message;
          }
        };
        
        // Delete a single transaction
        const deleteTransaction = async (id) => {
          if (!confirm('Are you sure you want to delete this transaction?')) {
            return;
          }
          
          try {
            await api.transactions.delete(id);
            
            // Refresh transactions after deletion
            await fetchTransactions();
          } catch (error) {
            console.error('Failed to delete transaction:', error);
            state.errors.transactions = error.message;
          }
        };
        
        // Delete multiple transactions
        const deleteBatchTransactions = async () => {
          if (selectedTransactions.value.length === 0) {
            return;
          }
          
          if (!confirm(`Are you sure you want to delete ${selectedTransactions.value.length} transaction(s)?`)) {
            return;
          }
          
          try {
            const deletePromises = selectedTransactions.value.map(id => api.transactions.delete(id));
            await Promise.all(deletePromises);
            
            // Refresh transactions after deletion
            await fetchTransactions();
            
            // Clear selection
            selectedTransactions.value = [];
            selectAllTransactions.value = false;
          } catch (error) {
            console.error('Failed to delete transactions:', error);
            state.errors.transactions = error.message;
          }
        };
        
        // Category filter helper functions
        const getIncomeCategories = (categories) => {
          return categories.filter(category => category.type === 'income');
        };
        
        const getExpenseCategories = (categories) => {
          return categories.filter(category => category.type === 'expense');
        };
        
        return {
          // State variables
          state,
          hasData,
          isUploadActive,
          uploadProgress,
          activeTab,
          selectedDateRange,
          
          // Transaction management
          transactionSearchQuery,
          selectedTransactions,
          selectAllTransactions,
          transactionTypeFilter,
          transactionDateFilter,
          categoryFilter,
          paginationStart,
          paginationLimit,
          transactionSort,
          batchCategoryId,
          batchTags,
          batchNotes,
          isFilterDropdownOpen,
          
          // Transaction modal
          isTransactionModalOpen,
          editingTransactionId,
          transactionForm,
          editTransaction,
          closeTransactionModal,
          saveTransaction,
          
          // Category management
          isCategoryModalOpen,
          editingCategoryId,
          categoryForm,
          colorPalette,
          isBatchCategoryModalOpen,
          filteredTransactions,
          sortedTransactions,
          paginatedTransactions,
          currentPage,
          
          // Transaction functions
          formatDate,
          formatCurrency,
          getCategoryName,
          getCategoryColor,
          formatAccountType,
          filterTransactions,
          sortTransactions,
          toggleSelectAll,
          calculateTotalIncome,
          calculateTotalExpenses,
          calculateCountByType,
          setTransactionTypeFilter,
          setTransactionDateFilter,
          setCategoryFilter,
          toggleFilterDropdown,
          closeFilterDropdown,
          previousPage,
          nextPage,
          openCategoryModal,
          closeCategoryModal,
          saveCategory,
          deleteCategory,
          editCategory,
          incomeCategories,
          expenseCategories,
          getCategoryTransactionCount,
          getCategoryTotal,
          openBatchCategoryModal,
          applyBatchCategory,
          deleteTransaction,
          deleteBatchTransactions,
          
          // File upload and UI control
          handleFileUpload,
          handleFileDrop,
          useSampleData,
          setUploadActive,
          setDateRange,
          
          // Enrichment flow functions
          closeEnrichmentModal,
          applyEnrichmentToBatches,
          fetchEnrichmentBatches,
          enrichBatch,
          completeUpload,
          updateEnrichmentProgress,
          getIncomeCategories,
          getExpenseCategories
        };
      }
    }).mount('#app');
    
    // Create Charts
    window.addEventListener('load', function() {
      setTimeout(() => {
        initCharts();
      }, 500);
    });
    
    function initCharts() {
      // Monthly Spending Bar Chart
      const monthlySpendingCtx = document.getElementById('monthlySpendingChart');
      if (monthlySpendingCtx) {
        const monthlySpendingChart = new Chart(monthlySpendingCtx, {
          type: 'bar',
          data: {
            labels: ['Housing', 'Food', 'Transportation', 'Entertainment', 'Utilities', 'Shopping', 'Healthcare', 'Personal Care', 'Education'],
            datasets: [{
              label: 'Spending Amount',
              data: [1200, 550, 350, 200, 180, 320, 150, 90, 220],
              backgroundColor: [
                'rgba(52, 211, 153, 0.8)',
                'rgba(59, 130, 246, 0.8)',
                'rgba(139, 92, 246, 0.8)',
                'rgba(249, 115, 22, 0.8)',
                'rgba(239, 68, 68, 0.8)',
                'rgba(16, 185, 129, 0.8)',
                'rgba(14, 165, 233, 0.8)',
                'rgba(168, 85, 247, 0.8)',
                'rgba(251, 146, 60, 0.8)'
              ],
              borderColor: [
                'rgba(52, 211, 153, 1)',
                'rgba(59, 130, 246, 1)',
                'rgba(139, 92, 246, 1)',
                'rgba(249, 115, 22, 1)',
                'rgba(239, 68, 68, 1)',
                'rgba(16, 185, 129, 1)',
                'rgba(14, 165, 233, 1)',
                'rgba(168, 85, 247, 1)',
                'rgba(251, 146, 60, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: (context) => {
                    const value = context.raw;
                    return `$${value.toLocaleString()}`;
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: (value) => `$${value}`
                }
              }
            }
          }
        });
      }
      
      // Spending Trend Line Chart
      const trendCtx = document.getElementById('trendChart');
      if (trendCtx) {
        // Generate dates for the last 12 months
        const today = new Date();
        const dates = Array.from({ length: 12 }, (_, i) => {
          const date = new Date(today);
          date.setDate(1);
          date.setMonth(today.getMonth() - i);
          return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
        }).reverse();
        
        // Random data for spending trend
        const spendingData = Array.from({ length: 12 }, () => {
          const baseAmount = 2500;
          const variance = Math.random() * 1000 - 500; // Random between -500 and 500
          return Math.round(baseAmount + variance);
        });
        
        const trendChart = new Chart(trendCtx, {
          type: 'line',
          data: {
            labels: dates,
            datasets: [{
              label: 'Spending Trend',
              data: spendingData,
              borderColor: 'rgba(124, 58, 237, 1)',
              backgroundColor: 'rgba(124, 58, 237, 0.2)',
              borderWidth: 2,
              tension: 0.3,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: (context) => {
                    const value = context.raw;
                    return `$${value.toLocaleString()}`;
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: (value) => `$${value}`
                }
              }
            }
          }
        });
      }
      
      // Category Doughnut Chart
      const categoryCtx = document.getElementById('categoryChart');
      if (categoryCtx) {
        const categoryChart = new Chart(categoryCtx, {
          type: 'doughnut',
          data: {
            labels: ['Housing', 'Food', 'Transportation', 'Entertainment', 'Utilities', 'Shopping'],
            datasets: [{
              label: 'Spending by Category',
              data: [1200, 550, 350, 200, 180, 320],
              backgroundColor: [
                'rgba(124, 58, 237, 0.8)',
                'rgba(52, 211, 153, 0.8)',
                'rgba(59, 130, 246, 0.8)',
                'rgba(249, 115, 22, 0.8)',
                'rgba(239, 68, 68, 0.8)',
                'rgba(16, 185, 129, 0.8)'
              ],
              borderColor: [
                'rgba(124, 58, 237, 1)',
                'rgba(52, 211, 153, 1)',
                'rgba(59, 130, 246, 1)',
                'rgba(249, 115, 22, 1)',
                'rgba(239, 68, 68, 1)',
                'rgba(16, 185, 129, 1)'
              ],
              borderWidth: 1,
              hoverOffset: 15
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '60%',
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  boxWidth: 15,
                  padding: 15
                }
              },
              tooltip: {
                callbacks: {
                  label: (context) => {
                    const value = context.raw;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = Math.round((value / total) * 100);
                    return `${context.label}: $${value.toLocaleString()} (${percentage}%)`;
                  }
                }
              }
            }
          }
        });
      }
      
      // Income vs Expenses Stacked Chart
      const incomeExpensesCtx = document.getElementById('incomeExpensesChart');
      if (incomeExpensesCtx) {
        // Generate dates for the last 6 months
        const today = new Date();
        const dates = Array.from({ length: 6 }, (_, i) => {
          const date = new Date(today);
          date.setDate(1);
          date.setMonth(today.getMonth() - i);
          return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
        }).reverse();
        
        // Random data for income and expenses
        const incomeData = Array.from({ length: 6 }, () => {
          return Math.round(3800 + (Math.random() * 400 - 200));
        });
        
        const expensesData = incomeData.map(income => {
          const expenseRatio = 0.7 + (Math.random() * 0.25);
          return Math.round(income * expenseRatio);
        });
        
        const incomeExpensesChart = new Chart(incomeExpensesCtx, {
          type: 'bar',
          data: {
            labels: dates,
            datasets: [
              {
                label: 'Income',
                data: incomeData,
                backgroundColor: 'rgba(52, 211, 153, 0.8)',
                borderColor: 'rgba(52, 211, 153, 1)',
                borderWidth: 1
              },
              {
                label: 'Expenses',
                data: expensesData,
                backgroundColor: 'rgba(229, 62, 62, 0.8)',
                borderColor: 'rgba(229, 62, 62, 1)',
                borderWidth: 1
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'top',
              },
              tooltip: {
                callbacks: {
                  label: (context) => {
                    const value = context.raw;
                    const label = context.dataset.label;
                    return `${label}: $${value.toLocaleString()}`;
                  },
                  afterBody: (tooltipItems) => {
                    const index = tooltipItems[0].dataIndex;
                    const income = incomeData[index];
                    const expenses = expensesData[index];
                    
                    const difference = income - expenses;
                    const isSurplus = difference >= 0;
                    const label = isSurplus ? 'Savings' : 'Deficit';
                    const value = Math.abs(difference);
                    
                    return [`${label}: $${value.toLocaleString()}`];
                  }
                }
              }
            },
            scales: {
              x: {
                stacked: false,
              },
              y: {
                beginAtZero: true,
                ticks: {
                  callback: (value) => `$${value}`
                }
              }
            }
          }
        });
      }
    }
  </script>
</body>
</html>